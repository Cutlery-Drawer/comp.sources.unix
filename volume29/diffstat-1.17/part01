Newsgroups: comp.sources.unix
From: dickey@clark.net (T.E.Dickey)
Subject: v29i030: diffstat-1.17 - postprocess "diff" output, make histogram of changed files, Part01/01
Message-id: <1.813904453.24690@gw.home.vix.com>
Sender: unix-sources-moderator@gw.home.vix.com
Approved: vixie@gw.home.vix.com

Submitted-By: dickey@clark.net (T.E.Dickey)
Posting-Number: Volume 29, Issue 30
Archive-Name: diffstat-1.17/part01

This program is a simple filter that reads the output of the 'diff' program,
and produces a histogram of the total number of lines that were changed.  It
is useful for scanning a patch file to see which files were changed.

This is a reposting of the program to consolidate the patches over the past
year, and to use autoconf 2.3.

#!/bin/sh
# This is a shell archive (produced by GNU sharutils 4.1).
# To extract the files from this archive, save it to some FILE, remove
# everything before the `!/bin/sh' line above, then type `sh FILE'.
#
# Made on 1995-10-16 21:33 PDT by <vixie@gw.home.vix.com>.
# Source directory was `/tmp_mnt/fs/a3/CSU/Going/diffstat-1.17'.
#
# Existing files will *not* be overwritten unless `-c' is specified.
#
# This shar contains:
# length mode       name
# ------ ---------- ------------------------------------------
#    670 -r--r--r-- CHANGES
#    406 -r--r--r-- README
#    249 -r--r--r-- config_h.in
#  32818 -r-xr-xr-x configure
#    753 -r--r--r-- configure.in
#   2696 -r--r--r-- diffstat.1
#  11122 -r--r--r-- diffstat.c
#   4771 -r-xr-xr-x install.sh
#   2225 -r--r--r-- makefile.in
#    649 -r-xr-xr-x mkdirs.sh
#     21 -r--r--r-- patchlev.h
#
touch -am 1231235999 $$.touch >/dev/null 2>&1
if test ! -f 1231235999 && test -f $$.touch; then
  shar_touch=touch
else
  shar_touch=:
  echo
  echo 'WARNING: not restoring timestamps.  Consider getting and'
  echo "installing GNU \`touch', distributed in GNU File Utilities..."
  echo
fi
rm -f 1231235999 $$.touch
#
# ============= CHANGES ==============
if test -f 'CHANGES' && test X"$1" != X"-c"; then
  echo 'x - skipping CHANGES (file already exists)'
else
  echo 'x - extracting CHANGES (text)'
  sed 's/^X//' << 'SHAR_EOF' > 'CHANGES' &&
Patch 3 (06-May-1995)
X
X	Repost whole program to comp.sources.misc (1.17)
X
X	Mods to scaling: limit to 1:1 if only a few changes were made; added
X	logic to accumulate error across +/-/!  calls.
X
X	added logic to recognize 'rcsdiff -u' output.
X
Patch 2 (26-Dec-1994)
X
X	Strip common pathname prefix (1.15)
X
Patch 1 (13-Nov-1994)
X
X	Test for <string.h> vs <strings.h>
X
X	Corrected error in 'match()' that didn't handle properly the case when
X	an argument was a null string (i.e., blank lines in a unified diff).
X
X	Added options '-n' and '-V'
X
X	Added patchlev.h, CHANGES files.
X
X	Added install.sh, for autoconf 2.1
X
X
Patch 0 (13-Jun-1994)
X
X	Initial version of 'diffstat' (1.12).
SHAR_EOF
  $shar_touch -am 0506070095 'CHANGES' &&
  chmod 0444 'CHANGES' ||
  echo 'restore of CHANGES failed'
  shar_count="`wc -c < 'CHANGES'`"
  test 670 -eq "$shar_count" ||
    echo "CHANGES: original size 670, current size $shar_count"
fi
# ============= README ==============
if test -f 'README' && test X"$1" != X"-c"; then
  echo 'x - skipping README (file already exists)'
else
  echo 'x - extracting README (text)'
  sed 's/^X//' << 'SHAR_EOF' > 'README' &&
$Id: README,v 1.3 1995/05/06 14:00:58 tom Exp $
X
Readme file for DiffStat.
X
This program is a simple filter that reads the output of the 'diff' program,
and produces a histogram of the total number of lines that were changed.  It is
useful for scanning a patch file to see which files were changed.
X
This is a reposting of the program to consolidate the patches over the past
year, and to use autoconf 2.3
SHAR_EOF
  $shar_touch -am 0506070095 'README' &&
  chmod 0444 'README' ||
  echo 'restore of README failed'
  shar_count="`wc -c < 'README'`"
  test 406 -eq "$shar_count" ||
    echo "README: original size 406, current size $shar_count"
fi
# ============= config_h.in ==============
if test -f 'config_h.in' && test X"$1" != X"-c"; then
  echo 'x - skipping config_h.in (file already exists)'
else
  echo 'x - extracting config_h.in (text)'
  sed 's/^X//' << 'SHAR_EOF' > 'config_h.in' &&
/* 
X * $Id: config_h.in,v 1.1 1994/06/12 23:48:18 tom Exp $
X * config_h.in is a template file used by configure to produce config.h.
X * config_h is then transformed (by config.status) into the header file 
X * config.h -- Kevin Buettner.
X */
X
@DEFS@
SHAR_EOF
  $shar_touch -am 0612164894 'config_h.in' &&
  chmod 0444 'config_h.in' ||
  echo 'restore of config_h.in failed'
  shar_count="`wc -c < 'config_h.in'`"
  test 249 -eq "$shar_count" ||
    echo "config_h.in: original size 249, current size $shar_count"
fi
# ============= configure ==============
if test -f 'configure' && test X"$1" != X"-c"; then
  echo 'x - skipping configure (file already exists)'
else
  echo 'x - extracting configure (text)'
  sed 's/^X//' << 'SHAR_EOF' > 'configure' &&
#! /bin/sh
X
# From configure.in Revision: 1.3 
# Guess values for system-dependent variables and create Makefiles.
# Generated automatically using autoconf version 2.3 
# Copyright (C) 1992, 1993, 1994 Free Software Foundation, Inc.
#
# This configure script is free software; the Free Software Foundation
# gives unlimited permission to copy, distribute and modify it.
X
# Defaults:
ac_help=
ac_default_prefix=/usr/local
# Any additions from configure.in:
X
# Initialize some variables set by options.
# The variables have the same names as the options, with
# dashes changed to underlines.
build=NONE
cache_file=./config.cache
exec_prefix=NONE
host=NONE
no_create=
nonopt=NONE
no_recursion=
prefix=NONE
program_prefix=NONE
program_suffix=NONE
program_transform_name=s,x,x,
silent=
site=
srcdir=
target=NONE
verbose=
x_includes=NONE
x_libraries=NONE
X
# Initialize some other variables.
subdirs=
X
ac_prev=
for ac_option
do
X
X  # If the previous option needs an argument, assign it.
X  if test -n "$ac_prev"; then
X    eval "$ac_prev=\$ac_option"
X    ac_prev=
X    continue
X  fi
X
X  case "$ac_option" in
X  -*=*) ac_optarg=`echo "$ac_option" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
X  *) ac_optarg= ;;
X  esac
X
X  # Accept the important Cygnus configure options, so we can diagnose typos.
X
X  case "$ac_option" in
X
X  -build | --build | --buil | --bui | --bu | --b)
X    ac_prev=build ;;
X  -build=* | --build=* | --buil=* | --bui=* | --bu=* | --b=*)
X    build="$ac_optarg" ;;
X
X  -cache-file | --cache-file | --cache-fil | --cache-fi \
X  | --cache-f | --cache- | --cache | --cach | --cac | --ca | --c)
X    ac_prev=cache_file ;;
X  -cache-file=* | --cache-file=* | --cache-fil=* | --cache-fi=* \
X  | --cache-f=* | --cache-=* | --cache=* | --cach=* | --cac=* | --ca=* | --c=*)
X    cache_file="$ac_optarg" ;;
X
X  -disable-* | --disable-*)
X    ac_feature=`echo $ac_option|sed -e 's/-*disable-//'`
X    # Reject names that are not valid shell variable names.
X    if test -n "`echo $ac_feature| sed 's/[-a-zA-Z0-9_]//g'`"; then
X      { echo "configure: error: $ac_feature: invalid feature name" 1>&2; exit 1; }
X    fi
X    ac_feature=`echo $ac_feature| sed 's/-/_/g'`
X    eval "enable_${ac_feature}=no" ;;
X
X  -enable-* | --enable-*)
X    ac_feature=`echo $ac_option|sed -e 's/-*enable-//' -e 's/=.*//'`
X    # Reject names that are not valid shell variable names.
X    if test -n "`echo $ac_feature| sed 's/[-_a-zA-Z0-9]//g'`"; then
X      { echo "configure: error: $ac_feature: invalid feature name" 1>&2; exit 1; }
X    fi
X    ac_feature=`echo $ac_feature| sed 's/-/_/g'`
X    case "$ac_option" in
X      *=*) ;;
X      *) ac_optarg=yes ;;
X    esac
X    eval "enable_${ac_feature}='$ac_optarg'" ;;
X
X  -exec-prefix | --exec_prefix | --exec-prefix | --exec-prefi \
X  | --exec-pref | --exec-pre | --exec-pr | --exec-p | --exec- \
X  | --exec | --exe | --ex)
X    ac_prev=exec_prefix ;;
X  -exec-prefix=* | --exec_prefix=* | --exec-prefix=* | --exec-prefi=* \
X  | --exec-pref=* | --exec-pre=* | --exec-pr=* | --exec-p=* | --exec-=* \
X  | --exec=* | --exe=* | --ex=*)
X    exec_prefix="$ac_optarg" ;;
X
X  -gas | --gas | --ga | --g)
X    # Obsolete; use --with-gas.
X    with_gas=yes ;;
X
X  -help | --help | --hel | --he)
X    # Omit some internal or obsolete options to make the list less imposing.
X    # This message is too long to be a string in the A/UX 3.1 sh.
X    cat << EOF
Usage: configure [options] [host]
Options: [defaults in brackets after descriptions]
Configuration:
X  --cache-file=FILE       cache test results in FILE
X  --help                  print this message
X  --no-create             do not create output files
X  --quiet, --silent       do not print \`checking...' messages
X  --version               print the version of autoconf that created configure
Directory and file names:
X  --prefix=PREFIX         install architecture-independent files in PREFIX
X                          [$ac_default_prefix]
X  --exec-prefix=PREFIX    install architecture-dependent files in PREFIX
X                          [same as prefix]
X  --srcdir=DIR            find the sources in DIR [configure dir or ..]
X  --program-prefix=PREFIX prepend PREFIX to installed program names
X  --program-suffix=SUFFIX append SUFFIX to installed program names
X  --program-transform-name=PROGRAM run sed PROGRAM on installed program names
Host type:
X  --build=BUILD           configure for building on BUILD [BUILD=HOST]
X  --host=HOST             configure for HOST [guessed]
X  --target=TARGET         configure for TARGET [TARGET=HOST]
Features and packages:
X  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
X  --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
X  --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
X  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
X  --x-includes=DIR        X include files are in DIR
X  --x-libraries=DIR       X library files are in DIR
--enable and --with options recognized:$ac_help
EOF
X    exit 0 ;;
X
X  -host | --host | --hos | --ho)
X    ac_prev=host ;;
X  -host=* | --host=* | --hos=* | --ho=*)
X    host="$ac_optarg" ;;
X
X  -nfp | --nfp | --nf)
X    # Obsolete; use --without-fp.
X    with_fp=no ;;
X
X  -no-create | --no-create | --no-creat | --no-crea | --no-cre \
X  | --no-cr | --no-c)
X    no_create=yes ;;
X
X  -no-recursion | --no-recursion | --no-recursio | --no-recursi \
X  | --no-recurs | --no-recur | --no-recu | --no-rec | --no-re | --no-r)
X    no_recursion=yes ;;
X
X  -prefix | --prefix | --prefi | --pref | --pre | --pr | --p)
X    ac_prev=prefix ;;
X  -prefix=* | --prefix=* | --prefi=* | --pref=* | --pre=* | --pr=* | --p=*)
X    prefix="$ac_optarg" ;;
X
X  -program-prefix | --program-prefix | --program-prefi | --program-pref \
X  | --program-pre | --program-pr | --program-p)
X    ac_prev=program_prefix ;;
X  -program-prefix=* | --program-prefix=* | --program-prefi=* \
X  | --program-pref=* | --program-pre=* | --program-pr=* | --program-p=*)
X    program_prefix="$ac_optarg" ;;
X
X  -program-suffix | --program-suffix | --program-suffi | --program-suff \
X  | --program-suf | --program-su | --program-s)
X    ac_prev=program_suffix ;;
X  -program-suffix=* | --program-suffix=* | --program-suffi=* \
X  | --program-suff=* | --program-suf=* | --program-su=* | --program-s=*)
X    program_suffix="$ac_optarg" ;;
X
X  -program-transform-name | --program-transform-name \
X  | --program-transform-nam | --program-transform-na \
X  | --program-transform-n | --program-transform- \
X  | --program-transform | --program-transfor \
X  | --program-transfo | --program-transf \
X  | --program-trans | --program-tran \
X  | --progr-tra | --program-tr | --program-t)
X    ac_prev=program_transform_name ;;
X  -program-transform-name=* | --program-transform-name=* \
X  | --program-transform-nam=* | --program-transform-na=* \
X  | --program-transform-n=* | --program-transform-=* \
X  | --program-transform=* | --program-transfor=* \
X  | --program-transfo=* | --program-transf=* \
X  | --program-trans=* | --program-tran=* \
X  | --progr-tra=* | --program-tr=* | --program-t=*)
X    program_transform_name="$ac_optarg" ;;
X
X  -q | -quiet | --quiet | --quie | --qui | --qu | --q \
X  | -silent | --silent | --silen | --sile | --sil)
X    silent=yes ;;
X
X  -site | --site | --sit)
X    ac_prev=site ;;
X  -site=* | --site=* | --sit=*)
X    site="$ac_optarg" ;;
X
X  -srcdir | --srcdir | --srcdi | --srcd | --src | --sr)
X    ac_prev=srcdir ;;
X  -srcdir=* | --srcdir=* | --srcdi=* | --srcd=* | --src=* | --sr=*)
X    srcdir="$ac_optarg" ;;
X
X  -target | --target | --targe | --targ | --tar | --ta | --t)
X    ac_prev=target ;;
X  -target=* | --target=* | --targe=* | --targ=* | --tar=* | --ta=* | --t=*)
X    target="$ac_optarg" ;;
X
X  -v | -verbose | --verbose | --verbos | --verbo | --verb)
X    verbose=yes ;;
X
X  -version | --version | --versio | --versi | --vers)
X    echo "configure generated by autoconf version 2.3"
X    exit 0 ;;
X
X  -with-* | --with-*)
X    ac_package=`echo $ac_option|sed -e 's/-*with-//' -e 's/=.*//'`
X    # Reject names that are not valid shell variable names.
X    if test -n "`echo $ac_package| sed 's/[-_a-zA-Z0-9]//g'`"; then
X      { echo "configure: error: $ac_package: invalid package name" 1>&2; exit 1; }
X    fi
X    ac_package=`echo $ac_package| sed 's/-/_/g'`
X    case "$ac_option" in
X      *=*) ;;
X      *) ac_optarg=yes ;;
X    esac
X    eval "with_${ac_package}='$ac_optarg'" ;;
X
X  -without-* | --without-*)
X    ac_package=`echo $ac_option|sed -e 's/-*without-//'`
X    # Reject names that are not valid shell variable names.
X    if test -n "`echo $ac_package| sed 's/[-a-zA-Z0-9_]//g'`"; then
X      { echo "configure: error: $ac_package: invalid package name" 1>&2; exit 1; }
X    fi
X    ac_package=`echo $ac_package| sed 's/-/_/g'`
X    eval "with_${ac_package}=no" ;;
X
X  --x)
X    # Obsolete; use --with-x.
X    with_x=yes ;;
X
X  -x-includes | --x-includes | --x-include | --x-includ | --x-inclu \
X  | --x-incl | --x-inc | --x-in | --x-i)
X    ac_prev=x_includes ;;
X  -x-includes=* | --x-includes=* | --x-include=* | --x-includ=* | --x-inclu=* \
X  | --x-incl=* | --x-inc=* | --x-in=* | --x-i=*)
X    x_includes="$ac_optarg" ;;
X
X  -x-libraries | --x-libraries | --x-librarie | --x-librari \
X  | --x-librar | --x-libra | --x-libr | --x-lib | --x-li | --x-l)
X    ac_prev=x_libraries ;;
X  -x-libraries=* | --x-libraries=* | --x-librarie=* | --x-librari=* \
X  | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
X    x_libraries="$ac_optarg" ;;
X
X  -*) { echo "configure: error: $ac_option: invalid option; use --help to show usage" 1>&2; exit 1; }
X    ;;
X
X  *) 
X    if test -n "`echo $ac_option| sed 's/[-a-z0-9.]//g'`"; then
X      echo "configure: warning: $ac_option: invalid host type" 1>&2
X    fi
X    if test "x$nonopt" != xNONE; then
X      { echo "configure: error: can only configure for one host and one target at a time" 1>&2; exit 1; }
X    fi
X    nonopt="$ac_option"
X    ;;
X
X  esac
done
X
if test -n "$ac_prev"; then
X  { echo "configure: error: missing argument to --`echo $ac_prev | sed 's/_/-/g'`" 1>&2; exit 1; }
fi
X
trap 'rm -fr conftest* confdefs* core core.* *.core $ac_clean_files; exit 1' 1 2 15
X
# File descriptor usage:
# 0 standard input
# 1 file creation
# 2 errors and warnings
# 3 some systems may open it to /dev/tty
# 4 used on the Kubota Titan
# 6 checking for... messages and results
# 5 compiler messages saved in config.log
if test "$silent" = yes; then
X  exec 6>/dev/null
else
X  exec 6>&1
fi
exec 5>./config.log
X
echo "\
This file contains any messages produced by compilers while
running configure, to aid debugging if configure makes a mistake.
" 1>&5
X
# Strip out --no-create and --no-recursion so they do not pile up.
# Also quote any args containing shell metacharacters.
ac_configure_args=
for ac_arg
do
X  case "$ac_arg" in
X  -no-create | --no-create | --no-creat | --no-crea | --no-cre \
X  | --no-cr | --no-c) ;;
X  -no-recursion | --no-recursion | --no-recursio | --no-recursi \
X  | --no-recurs | --no-recur | --no-recu | --no-rec | --no-re | --no-r) ;;
X  *" "*|*"	"*|*[\[\]\~\#\$\^\&\*\(\)\{\}\\\|\;\<\>\?]*)
X  ac_configure_args="$ac_configure_args '$ac_arg'" ;;
X  *) ac_configure_args="$ac_configure_args $ac_arg" ;;
X  esac
done
X
# NLS nuisances.
# Only set LANG and LC_ALL to C if already set.
# These must not be set unconditionally because not all systems understand
# e.g. LANG=C (notably SCO).
if test "${LC_ALL+set}" = set; then LC_ALL=C; export LC_ALL; fi
if test "${LANG+set}"   = set; then LANG=C;   export LANG;   fi
X
# confdefs.h avoids OS command line length limits that DEFS can exceed.
rm -rf conftest* confdefs.h
# AIX cpp loses on an empty file, so make sure it contains at least a newline.
echo > confdefs.h
X
# A filename unique to this package, relative to the directory that
# configure is in, which we can look for to find out if srcdir is correct.
ac_unique_file=diffstat.c
X
# Find the source files, if location was not specified.
if test -z "$srcdir"; then
X  ac_srcdir_defaulted=yes
X  # Try the directory containing this script, then its parent.
X  ac_prog=$0
X  ac_confdir=`echo $ac_prog|sed 's%/[^/][^/]*$%%'`
X  test "x$ac_confdir" = "x$ac_prog" && ac_confdir=.
X  srcdir=$ac_confdir
X  if test ! -r $srcdir/$ac_unique_file; then
X    srcdir=..
X  fi
else
X  ac_srcdir_defaulted=no
fi
if test ! -r $srcdir/$ac_unique_file; then
X  if test "$ac_srcdir_defaulted" = yes; then
X    { echo "configure: error: can not find sources in $ac_confdir or .." 1>&2; exit 1; }
X  else
X    { echo "configure: error: can not find sources in $srcdir" 1>&2; exit 1; }
X  fi
fi
srcdir=`echo "${srcdir}" | sed 's%\([^/]\)/*$%\1%'`
X
# Prefer explicitly selected file to automatically selected ones.
if test -z "$CONFIG_SITE"; then
X  if test "x$prefix" != xNONE; then
X    CONFIG_SITE="$prefix/share/config.site $prefix/etc/config.site"
X  else
X    CONFIG_SITE="$ac_default_prefix/share/config.site $ac_default_prefix/etc/config.site"
X  fi
fi
for ac_site_file in $CONFIG_SITE; do
X  if test -r "$ac_site_file"; then
X    echo "loading site script $ac_site_file"
X    . "$ac_site_file"
X  fi
done
X
if test -r "$cache_file"; then
X  echo "loading cache $cache_file"
X  . $cache_file
else
X  echo "creating cache $cache_file"
X  > $cache_file
fi
X
ac_ext=c
# CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
ac_cpp='$CPP $CPPFLAGS'
ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5 2>&5'
ac_link='${CC-cc} -o conftest $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5 2>&5'
X
if (echo "testing\c"; echo 1,2,3) | grep c >/dev/null; then
X  # Stardent Vistra SVR4 grep lacks -e, says ghazi@caip.rutgers.edu.
X  if (echo -n testing; echo 1,2,3) | sed s/-n/xn/ | grep xn >/dev/null; then
X    ac_n= ac_c='
' ac_t='	'
X  else
X    ac_n=-n ac_c= ac_t=
X  fi
else
X  ac_n= ac_c='\c' ac_t=
fi
X
X
# Extract the first word of "gcc", so it can be a program name with args.
set dummy gcc; ac_word=$2
echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
X  echo $ac_n "(cached) $ac_c" 1>&6
else
X  if test -n "$CC"; then
X  ac_cv_prog_CC="$CC" # Let the user override the test.
else
X  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
X  for ac_dir in $PATH; do
X    test -z "$ac_dir" && ac_dir=.
X    if test -f $ac_dir/$ac_word; then
X      ac_cv_prog_CC="gcc"
X      break
X    fi
X  done
X  IFS="$ac_save_ifs"
X  test -z "$ac_cv_prog_CC" && ac_cv_prog_CC="cc"
fi
fi
CC="$ac_cv_prog_CC"
if test -n "$CC"; then
X  echo "$ac_t""$CC" 1>&6
else
X  echo "$ac_t""no" 1>&6
fi
X
X
echo $ac_n "checking whether we are using GNU C""... $ac_c" 1>&6
if eval "test \"`echo '$''{'ac_cv_prog_gcc'+set}'`\" = set"; then
X  echo $ac_n "(cached) $ac_c" 1>&6
else
X  cat > conftest.c <<EOF
#ifdef __GNUC__
X  yes;
#endif
EOF
if ${CC-cc} -E conftest.c 2>&5 | egrep yes >/dev/null 2>&1; then
X  ac_cv_prog_gcc=yes
else
X  ac_cv_prog_gcc=no
fi
fi
echo "$ac_t""$ac_cv_prog_gcc" 1>&6
if test $ac_cv_prog_gcc = yes; then
X  GCC=yes
X  if test "${CFLAGS+set}" != set; then
X    echo $ac_n "checking whether ${CC-cc} accepts -g""... $ac_c" 1>&6
if eval "test \"`echo '$''{'ac_cv_prog_gcc_g'+set}'`\" = set"; then
X  echo $ac_n "(cached) $ac_c" 1>&6
else
X  echo 'void f(){}' > conftest.c
if test -z "`${CC-cc} -g -c conftest.c 2>&1`"; then
X  ac_cv_prog_gcc_g=yes
else
X  ac_cv_prog_gcc_g=no
fi
rm -f conftest*
X
fi
X    echo "$ac_t""$ac_cv_prog_gcc_g" 1>&6
X    if test $ac_cv_prog_gcc_g = yes; then
X      CFLAGS="-g -O"
X    else
X      CFLAGS="-O"
X    fi
X  fi
else
X  GCC=
X  test "${CFLAGS+set}" = set || CFLAGS="-g"
fi
X
ac_aux_dir=
for ac_dir in $srcdir $srcdir/.. $srcdir/../..; do
X  if test -f $ac_dir/install-sh; then
X    ac_aux_dir=$ac_dir
X    ac_install_sh="$ac_aux_dir/install-sh -c"
X    break
X  elif test -f $ac_dir/install.sh; then
X    ac_aux_dir=$ac_dir
X    ac_install_sh="$ac_aux_dir/install.sh -c"
X    break
X  fi
done
if test -z "$ac_aux_dir"; then
X  { echo "configure: error: can not find install-sh or install.sh in $srcdir $srcdir/.. $srcdir/../.." 1>&2; exit 1; }
fi
ac_config_guess=$ac_aux_dir/config.guess
ac_config_sub=$ac_aux_dir/config.sub
ac_configure=$ac_aux_dir/configure # This should be Cygnus configure.
X
# Find a good install program.  We prefer a C program (faster),
# so one script is as good as another.  But avoid the broken or
# incompatible versions:
# SysV /etc/install, /usr/sbin/install
# SunOS /usr/etc/install
# IRIX /sbin/install
# AIX /bin/install
# AFS /usr/afsws/bin/install, which mishandles nonexistent args
# SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
# ./install, which can be erroneously created by make from ./install.sh.
echo $ac_n "checking for a BSD compatible install""... $ac_c" 1>&6
if test -z "$INSTALL"; then
if eval "test \"`echo '$''{'ac_cv_path_install'+set}'`\" = set"; then
X  echo $ac_n "(cached) $ac_c" 1>&6
else
X    IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
X  for ac_dir in $PATH; do
X    # Account for people who put trailing slashes in PATH elements.
X    case "$ac_dir/" in
X    /|./|.//|/etc/*|/usr/sbin/*|/usr/etc/*|/sbin/*|/usr/afsws/bin/*|/usr/ucb/*) ;;
X    *)
X      # OSF1 and SCO ODT 3.0 have their own names for install.
X      for ac_prog in ginstall installbsd scoinst install; do
X        if test -f $ac_dir/$ac_prog; then
X	  if test $ac_prog = install &&
X            grep dspmsg $ac_dir/$ac_prog >/dev/null 2>&1; then
X	    # AIX install.  It has an incompatible calling convention.
X	    # OSF/1 installbsd also uses dspmsg, but is usable.
X	    :
X	  else
X	    ac_cv_path_install="$ac_dir/$ac_prog -c"
X	    break 2
X	  fi
X	fi
X      done
X      ;;
X    esac
X  done
X  IFS="$ac_save_ifs"
X  # As a last resort, use the slow shell script.
X  test -z "$ac_cv_path_install" && ac_cv_path_install="$ac_install_sh"
fi
X  INSTALL="$ac_cv_path_install"
fi
echo "$ac_t""$INSTALL" 1>&6
X
# Use test -z because SunOS4 sh mishandles braces in ${var-val}.
# It thinks the first close brace ends the variable substitution.
test -z "$INSTALL_PROGRAM" && INSTALL_PROGRAM='${INSTALL}'
X
test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
X
echo $ac_n "checking how to run the C preprocessor""... $ac_c" 1>&6
# On Suns, sometimes $CPP names a directory.
if test -n "$CPP" && test -d "$CPP"; then
X  CPP=
fi
if test -z "$CPP"; then
if eval "test \"`echo '$''{'ac_cv_prog_CPP'+set}'`\" = set"; then
X  echo $ac_n "(cached) $ac_c" 1>&6
else
X    # This must be in double quotes, not single quotes, because CPP may get
X  # substituted into the Makefile and "${CC-cc}" will confuse make.
X  CPP="${CC-cc} -E"
X  # On the NeXT, cc -E runs the code through the compiler's parser,
X  # not just through cpp.
X  cat > conftest.$ac_ext <<EOF
#line 562 "configure"
#include "confdefs.h"
#include <assert.h>
Syntax Error
EOF
eval "$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
ac_err=`grep -v '^ *+' conftest.out`
if test -z "$ac_err"; then
X  :
else
X  echo "$ac_err" >&5
X  rm -rf conftest*
X  CPP="${CC-cc} -E -traditional-cpp"
X  cat > conftest.$ac_ext <<EOF
#line 576 "configure"
#include "confdefs.h"
#include <assert.h>
Syntax Error
EOF
eval "$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
ac_err=`grep -v '^ *+' conftest.out`
if test -z "$ac_err"; then
X  :
else
X  echo "$ac_err" >&5
X  rm -rf conftest*
X  CPP=/lib/cpp
fi
rm -f conftest*
fi
rm -f conftest*
X  ac_cv_prog_CPP="$CPP"
fi
fi
CPP="$ac_cv_prog_CPP"
echo "$ac_t""$CPP" 1>&6
X
if test $ac_cv_prog_gcc = yes; then
X  echo $ac_n "checking whether ${CC-cc} needs -traditional""... $ac_c" 1>&6
if eval "test \"`echo '$''{'ac_cv_prog_gcc_traditional'+set}'`\" = set"; then
X  echo $ac_n "(cached) $ac_c" 1>&6
else
X    ac_pattern="Autoconf.*'x'"
X  cat > conftest.$ac_ext <<EOF
#line 606 "configure"
#include "confdefs.h"
#include <sgtty.h>
Autoconf TIOCGETP
EOF
if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
X  egrep "$ac_pattern" >/dev/null 2>&1; then
X  rm -rf conftest*
X  ac_cv_prog_gcc_traditional=yes
else
X  rm -rf conftest*
X  ac_cv_prog_gcc_traditional=no
fi
rm -f conftest*
X
X
X  if test $ac_cv_prog_gcc_traditional = no; then
X    cat > conftest.$ac_ext <<EOF
#line 624 "configure"
#include "confdefs.h"
#include <termio.h>
Autoconf TCGETA
EOF
if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
X  egrep "$ac_pattern" >/dev/null 2>&1; then
X  rm -rf conftest*
X  ac_cv_prog_gcc_traditional=yes
fi
rm -f conftest*
X
X  fi
fi
X  echo "$ac_t""$ac_cv_prog_gcc_traditional" 1>&6
X  if test $ac_cv_prog_gcc_traditional = yes; then
X    CC="$CC -traditional"
X  fi
fi
X
X
if test -n "$GCC"
then
CFLAGS='-O -Wall -Wshadow -Wconversion -Wstrict-prototypes -Wmissing-prototypes'
fi
X
X
X
echo $ac_n "checking for working const""... $ac_c" 1>&6
if eval "test \"`echo '$''{'ac_cv_c_const'+set}'`\" = set"; then
X  echo $ac_n "(cached) $ac_c" 1>&6
else
X  cat > conftest.$ac_ext <<EOF
#line 657 "configure"
#include "confdefs.h"
X
int main() { return 0; }
int t() {
X
/* Ultrix mips cc rejects this.  */
typedef int charset[2]; const charset x;
/* SunOS 4.1.1 cc rejects this.  */
char const *const *ccp;
char **p;
/* NEC SVR4.0.2 mips cc rejects this.  */
struct point {int x, y;};
static struct point const zero;
/* AIX XL C 1.02.0.0 rejects this.
X   It does not let you subtract one const X* pointer from another in an arm
X   of an if-expression whose if-part is not a constant expression */
const char *g = "string";
ccp = &g + (g ? g-g : 0);
/* HPUX 7.0 cc rejects these. */
++ccp;
p = (char**) ccp;
ccp = (char const *const *) p;
{ /* SCO 3.2v4 cc rejects this.  */
X  char *t;
X  char const *s = 0 ? (char *) 0 : (char const *) 0;
X
X  *t++ = 0;
}
{ /* Someone thinks the Sun supposedly-ANSI compiler will reject this.  */
X  int x[] = {25, 17};
X  const int *foo = &x[0];
X  ++foo;
}
{ /* Sun SC1.0 ANSI compiler rejects this -- but not the above. */
X  typedef const int *iptr;
X  iptr p = 0;
X  ++p;
}
{ /* AIX XL C 1.02.0.0 rejects this saying
X     "k.c", line 2.27: 1506-025 (S) Operand must be a modifiable lvalue. */
X  struct s { int j; const int *ap[3]; };
X  struct s *b; b->j = 5;
}
{ /* ULTRIX-32 V3.1 (Rev 9) vcc rejects this */
X  const int foo = 10;
}
X
; return 0; }
EOF
if eval $ac_compile; then
X  rm -rf conftest*
X  ac_cv_c_const=yes
else
X  rm -rf conftest*
X  ac_cv_c_const=no
fi
rm -f conftest*
X
fi
echo "$ac_t""$ac_cv_c_const" 1>&6
if test $ac_cv_c_const = no; then
X  cat >> confdefs.h <<\EOF
#define const 
EOF
X
fi
X
# If we cannot run a trivial program, we must be cross compiling.
echo $ac_n "checking whether cross-compiling""... $ac_c" 1>&6
if eval "test \"`echo '$''{'ac_cv_c_cross'+set}'`\" = set"; then
X  echo $ac_n "(cached) $ac_c" 1>&6
else
X  if test "$cross_compiling" = yes; then
X  ac_cv_c_cross=yes
else
cat > conftest.$ac_ext <<EOF
#line 734 "configure"
#include "confdefs.h"
main(){return(0);}
EOF
eval $ac_link
if test -s conftest && (./conftest; exit) 2>/dev/null; then
X  ac_cv_c_cross=no
else
X  ac_cv_c_cross=yes
fi
fi
rm -fr conftest*
fi
cross_compiling=$ac_cv_c_cross
echo "$ac_t""$ac_cv_c_cross" 1>&6
X
echo $ac_n "checking for ANSI C header files""... $ac_c" 1>&6
if eval "test \"`echo '$''{'ac_cv_header_stdc'+set}'`\" = set"; then
X  echo $ac_n "(cached) $ac_c" 1>&6
else
X  cat > conftest.$ac_ext <<EOF
#line 755 "configure"
#include "confdefs.h"
#include <stdlib.h>
#include <stdarg.h>
#include <string.h>
#include <float.h>
EOF
eval "$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
ac_err=`grep -v '^ *+' conftest.out`
if test -z "$ac_err"; then
X  rm -rf conftest*
X  ac_cv_header_stdc=yes
else
X  echo "$ac_err" >&5
X  rm -rf conftest*
X  ac_cv_header_stdc=no
fi
rm -f conftest*
X
if test $ac_cv_header_stdc = yes; then
X  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
cat > conftest.$ac_ext <<EOF
#line 777 "configure"
#include "confdefs.h"
#include <string.h>
EOF
if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
X  egrep "memchr" >/dev/null 2>&1; then
X  :
else
X  rm -rf conftest*
X  ac_cv_header_stdc=no
fi
rm -f conftest*
X
fi
X
if test $ac_cv_header_stdc = yes; then
X  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
cat > conftest.$ac_ext <<EOF
#line 795 "configure"
#include "confdefs.h"
#include <stdlib.h>
EOF
if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
X  egrep "free" >/dev/null 2>&1; then
X  :
else
X  rm -rf conftest*
X  ac_cv_header_stdc=no
fi
rm -f conftest*
X
fi
X
if test $ac_cv_header_stdc = yes; then
X  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
if test "$cross_compiling" = yes; then
X  ac_cv_header_stdc=no
else
cat > conftest.$ac_ext <<EOF
#line 816 "configure"
#include "confdefs.h"
#include <ctype.h>
#define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
#define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
#define XOR(e, f) (((e) && !(f)) || (!(e) && (f)))
int main () { int i; for (i = 0; i < 256; i++)
if (XOR (islower (i), ISLOWER (i)) || toupper (i) != TOUPPER (i)) exit(2);
exit (0); }
X
EOF
eval $ac_link
if test -s conftest && (./conftest; exit) 2>/dev/null; then
X  :
else
X  ac_cv_header_stdc=no
fi
fi
rm -fr conftest*
fi
fi
echo "$ac_t""$ac_cv_header_stdc" 1>&6
if test $ac_cv_header_stdc = yes; then
X  cat >> confdefs.h <<\EOF
#define STDC_HEADERS 1
EOF
X
fi
X
for ac_hdr in stdlib.h unistd.h
do
ac_safe=`echo "$ac_hdr" | tr './\055' '___'`
echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
X  echo $ac_n "(cached) $ac_c" 1>&6
else
X  cat > conftest.$ac_ext <<EOF
#line 853 "configure"
#include "confdefs.h"
#include <$ac_hdr>
EOF
eval "$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
ac_err=`grep -v '^ *+' conftest.out`
if test -z "$ac_err"; then
X  rm -rf conftest*
X  eval "ac_cv_header_$ac_safe=yes"
else
X  echo "$ac_err" >&5
X  rm -rf conftest*
X  eval "ac_cv_header_$ac_safe=no"
fi
rm -f conftest*
fi
if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
X  echo "$ac_t""yes" 1>&6
X    ac_tr_hdr=HAVE_`echo $ac_hdr | tr '[a-z]./\055' '[A-Z]___'`
X  cat >> confdefs.h <<EOF
#define $ac_tr_hdr 1
EOF
X 
else
X  echo "$ac_t""no" 1>&6
fi
done
X
for ac_hdr in getopt.h string.h malloc.h
do
ac_safe=`echo "$ac_hdr" | tr './\055' '___'`
echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
X  echo $ac_n "(cached) $ac_c" 1>&6
else
X  cat > conftest.$ac_ext <<EOF
#line 889 "configure"
#include "confdefs.h"
#include <$ac_hdr>
EOF
eval "$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
ac_err=`grep -v '^ *+' conftest.out`
if test -z "$ac_err"; then
X  rm -rf conftest*
X  eval "ac_cv_header_$ac_safe=yes"
else
X  echo "$ac_err" >&5
X  rm -rf conftest*
X  eval "ac_cv_header_$ac_safe=no"
fi
rm -f conftest*
fi
if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
X  echo "$ac_t""yes" 1>&6
X    ac_tr_hdr=HAVE_`echo $ac_hdr | tr '[a-z]./\055' '[A-Z]___'`
X  cat >> confdefs.h <<EOF
#define $ac_tr_hdr 1
EOF
X 
else
X  echo "$ac_t""no" 1>&6
fi
done
X
X
###	output makefile and config.h
trap '' 1 2 15
cat > confcache <<\EOF
# This file is a shell script that caches the results of configure
# tests run on this system so they can be shared between configure
# scripts and configure runs.  It is not useful on other systems.
# If it contains results you don't want to keep, you may remove or edit it.
#
# By default, configure uses ./config.cache as the cache file,
# creating it if it does not exist already.  You can give configure
# the --cache-file=FILE option to use a different cache file; that is
# what configure does when it calls configure scripts in
# subdirectories, so they share the cache.
# Giving --cache-file=/dev/null disables caching, for debugging configure.
# config.status only pays attention to the cache file if you give it the
# --recheck option to rerun configure.
#
EOF
# Ultrix sh set writes to stderr and can't be redirected directly,
# and sets the high bit in the cache file unless we assign to the vars.
(set) 2>&1 |
X  sed -n "s/^\([a-zA-Z0-9_]*_cv_[a-zA-Z0-9_]*\)=\(.*\)/\1=\${\1='\2'}/p" \
X  >> confcache
if cmp -s $cache_file confcache; then
X  :
else
X  if test -w $cache_file; then
X    echo "updating cache $cache_file"
X    cat confcache > $cache_file
X  else
X    echo "not updating unwritable cache $cache_file"
X  fi
fi
rm -f confcache
X
trap 'rm -fr conftest* confdefs* core core.* *.core $ac_clean_files; exit 1' 1 2 15
X
test "x$prefix" = xNONE && prefix=$ac_default_prefix
# Let make expand exec_prefix.
test "x$exec_prefix" = xNONE && exec_prefix='${prefix}'
X
# Any assignment to VPATH causes Sun make to only execute
# the first set of double-colon rules, so remove it if not needed.
# If there is a colon in the path, we need to keep it.
if test "x$srcdir" = x.; then
X  ac_vpsub='/^[ 	]*VPATH[ 	]*=[^:]*$/d'
fi
X
trap 'rm -f $CONFIG_STATUS conftest*; exit 1' 1 2 15
X
# Transform confdefs.h into DEFS.
# Protect against shell expansion while executing Makefile rules.
# Protect against Makefile macro expansion.
cat > conftest.defs <<\EOF
s%#define \([A-Za-z_][A-Za-z0-9_]*\) \(.*\)%-D\1=\2%g
s%[ 	`~#$^&*(){}\\|;'"<>?]%\\&%g
s%\[%\\&%g
s%\]%\\&%g
s%\$%$$%g
EOF
DEFS=`sed -f conftest.defs confdefs.h | tr '\012' ' '`
rm -f conftest.defs
X
X
# Without the "./", some shells look in PATH for config.status.
: ${CONFIG_STATUS=./config.status}
X
echo creating $CONFIG_STATUS
rm -f $CONFIG_STATUS
cat > $CONFIG_STATUS <<EOF
#! /bin/sh
# Generated automatically by configure.
# Run this file to recreate the current configuration.
# This directory was configured as follows,
# on host `(hostname || uname -n) 2>/dev/null | sed 1q`:
#
# $0 $ac_configure_args
#
# Compiler output produced by configure, useful for debugging
# configure, is in ./config.log if it exists.
X
ac_cs_usage="Usage: $CONFIG_STATUS [--recheck] [--version] [--help]"
for ac_option
do
X  case "\$ac_option" in
X  -recheck | --recheck | --rechec | --reche | --rech | --rec | --re | --r)
X    echo "running \${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion"
X    exec \${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion ;;
X  -version | --version | --versio | --versi | --vers | --ver | --ve | --v)
X    echo "$CONFIG_STATUS generated by autoconf version 2.3"
X    exit 0 ;;
X  -help | --help | --hel | --he | --h)
X    echo "\$ac_cs_usage"; exit 0 ;;
X  *) echo "\$ac_cs_usage"; exit 1 ;;
X  esac
done
X
ac_given_srcdir=$srcdir
ac_given_INSTALL="$INSTALL"
X
trap 'rm -fr `echo "makefile config_h" | sed "s/:[^ ]*//g"` conftest*; exit 1' 1 2 15
X
# Protect against being on the right side of a sed subst in config.status. 
sed 's/%@/@@/; s/@%/@@/; s/%g$/@g/; /@g$/s/[\\\\&%]/\\\\&/g; 
X s/@@/%@/; s/@@/@%/; s/@g$/%g/' > conftest.subs <<\CEOF
$ac_vpsub
$extrasub
s%@CFLAGS@%$CFLAGS%g
s%@CPPFLAGS@%$CPPFLAGS%g
s%@CXXFLAGS@%$CXXFLAGS%g
s%@DEFS@%$DEFS%g
s%@LDFLAGS@%$LDFLAGS%g
s%@LIBS@%$LIBS%g
s%@exec_prefix@%$exec_prefix%g
s%@prefix@%$prefix%g
s%@program_transform_name@%$program_transform_name%g
s%@CC@%$CC%g
s%@INSTALL_PROGRAM@%$INSTALL_PROGRAM%g
s%@INSTALL_DATA@%$INSTALL_DATA%g
s%@CPP@%$CPP%g
X
CEOF
EOF
cat >> $CONFIG_STATUS <<EOF
X
CONFIG_FILES=\${CONFIG_FILES-"makefile config_h"}
EOF
cat >> $CONFIG_STATUS <<\EOF
for ac_file in .. $CONFIG_FILES; do if test "x$ac_file" != x..; then
X  # Support "outfile[:infile]", defaulting infile="outfile.in".
X  case "$ac_file" in
X  *:*) ac_file_in=`echo "$ac_file"|sed 's%.*:%%'`
X       ac_file=`echo "$ac_file"|sed 's%:.*%%'` ;;
X  *) ac_file_in="${ac_file}.in" ;;
X  esac
X
X  # Adjust relative srcdir, etc. for subdirectories.
X
X  # Remove last slash and all that follows it.  Not all systems have dirname.
X  ac_dir=`echo $ac_file|sed 's%/[^/][^/]*$%%'`
X  if test "$ac_dir" != "$ac_file" && test "$ac_dir" != .; then
X    # The file is in a subdirectory.
X    test ! -d "$ac_dir" && mkdir "$ac_dir"
X    ac_dir_suffix="/`echo $ac_dir|sed 's%^\./%%'`"
X    # A "../" for each directory in $ac_dir_suffix.
X    ac_dots=`echo $ac_dir_suffix|sed 's%/[^/]*%../%g'`
X  else
X    ac_dir_suffix= ac_dots=
X  fi
X
X  case "$ac_given_srcdir" in
X  .)  srcdir=.
X      if test -z "$ac_dots"; then top_srcdir=.
X      else top_srcdir=`echo $ac_dots|sed 's%/$%%'`; fi ;;
X  /*) srcdir="$ac_given_srcdir$ac_dir_suffix"; top_srcdir="$ac_given_srcdir" ;;
X  *) # Relative path.
X    srcdir="$ac_dots$ac_given_srcdir$ac_dir_suffix"
X    top_srcdir="$ac_dots$ac_given_srcdir" ;;
X  esac
X
X  case "$ac_given_INSTALL" in
X  [/$]*) INSTALL="$ac_given_INSTALL" ;;
X  *) INSTALL="$ac_dots$ac_given_INSTALL" ;;
X  esac
X  echo creating "$ac_file"
X  rm -f "$ac_file"
X  configure_input="Generated automatically from `echo $ac_file_in|sed 's%.*/%%'` by configure."
X  case "$ac_file" in
X  *Makefile*) ac_comsub="1i\\
# $configure_input" ;;
X  *) ac_comsub= ;;
X  esac
X  sed -e "$ac_comsub
s%@configure_input@%$configure_input%g
s%@srcdir@%$srcdir%g
s%@top_srcdir@%$top_srcdir%g
s%@INSTALL@%$INSTALL%g
" -f conftest.subs $ac_given_srcdir/$ac_file_in > $ac_file
fi; done
rm -f conftest.subs
X
X
X
echo creating config.h
sed	-e '/^# /d' \
X	-e 's/ -D/\
#define /g' \
X	-e 's/\(#define [A-Za-z_][A-Za-z0-9_]*\)=/\1	/g' \
X	config_h >config.h
X
echo removing config_h
rm config_h
X
Xexit 0
EOF
chmod +x $CONFIG_STATUS
rm -fr confdefs* $ac_clean_files
test "$no_create" = yes || ${CONFIG_SHELL-/bin/sh} $CONFIG_STATUS || exit 1
X
SHAR_EOF
  $shar_touch -am 0506062695 'configure' &&
  chmod 0555 'configure' ||
  echo 'restore of configure failed'
  shar_count="`wc -c < 'configure'`"
  test 32818 -eq "$shar_count" ||
    echo "configure: original size 32818, current size $shar_count"
fi
# ============= configure.in ==============
if test -f 'configure.in' && test X"$1" != X"-c"; then
  echo 'x - skipping configure.in (file already exists)'
else
  echo 'x - extracting configure.in (text)'
  sed 's/^X//' << 'SHAR_EOF' > 'configure.in' &&
dnl Process this file with 'autoconf' to produce a 'configure' script
dnl $Id: configure.in,v 1.3 1994/06/14 00:06:44 tom Exp $
AC_REVISION($Revision: 1.3 $)
AC_INIT(diffstat.c)
AC_PROG_CC
AC_PROG_INSTALL
AC_GCC_TRADITIONAL
X
if test -n "$GCC"
then
CFLAGS='-O -Wall -Wshadow -Wconversion -Wstrict-prototypes -Wmissing-prototypes'
fi
AC_SUBST(CFLAGS)
AC_SUBST(LIBS)
X
AC_CONST
AC_STDC_HEADERS
AC_HAVE_HEADERS(stdlib.h unistd.h)
AC_HAVE_HEADERS(getopt.h string.h malloc.h)
X
###	output makefile and config.h
changequote({,})dnl
AC_OUTPUT(makefile config_h,
{
echo creating config.h
sed	-e '/^# /d' \
X	-e 's/ -D/\
#define /g' \
X	-e 's/\(#define [A-Za-z_][A-Za-z0-9_]*\)=/\1	/g' \
X	config_h >config.h
}
echo removing config_h
rm config_h
)
changequote([,])dnl
SHAR_EOF
  $shar_touch -am 0613170694 'configure.in' &&
  chmod 0444 'configure.in' ||
  echo 'restore of configure.in failed'
  shar_count="`wc -c < 'configure.in'`"
  test 753 -eq "$shar_count" ||
    echo "configure.in: original size 753, current size $shar_count"
fi
# ============= diffstat.1 ==============
if test -f 'diffstat.1' && test X"$1" != X"-c"; then
  echo 'x - skipping diffstat.1 (file already exists)'
else
  echo 'x - extracting diffstat.1 (text)'
  sed 's/^X//' << 'SHAR_EOF' > 'diffstat.1' &&
X.\"*****************************************************************************
X.\" Copyright (c) 1994 by Thomas E. Dickey.  All Rights Reserved.              *
X.\"                                                                            *
X.\" You may freely copy or redistribute this software, so long as there is no  *
X.\" profit made from its use, sale trade or reproduction. You may not change   *
X.\" this copyright notice, and it must be included in any copy made.           *
X.\"*****************************************************************************
X.\" $Id: diffstat.1,v 1.4 1994/11/13 19:42:43 tom Exp $
X.de DS
X.RS
X.nf
X.sp
X..
X.de DE
X.fi
X.RE
X.sp .5
X..
X.TH DIFFSTAT 1
X.
X.SH NAME
\fBdiffstat\fR \- make histogram from diff-output
X.
X.SH USAGE
\fBdiffstat\fI [options] [file-specifications]
X.
X.SH SYNOPSIS
This program reads the output of \fBdiff\fR and displays a histogram
of the insertions, deletions, and modifications per-file.
X.
X.SH DESCRIPTION
Diffstat is a program that is useful for reviewing large, complex patch files.
It reads from one or more input files which contain output from \fBdiff\fR,
producing a histogram of the total lines changed for each file referenced.
X.
X.PP
Diffstat recognizes the most popular types of output from diff:
X.
X.RS
X.TP
unified
preferred by the \fBpatch\fR utility.
X.
X.TP
context
best for readability, but not very compact.
X.
X.TP
default
not good for much, but simple to generate.
X.RE
X.
X.PP
\fBDiffstat\fR detects the lines that are output by \fBdiff\fR to
tell which files are compared, and then counts the markers in the
first column that denote the type of change (insertion, deletion
or modification).
These are shown in the histogram as "+", "-" and "!" characters.
X.
X.PP
If no filename is given on the command line,
\fBdiffstat\fR reads the differences from the standard input.
X.
X.SH OPTIONS
X.TP
X.BI \-n " number"
specify the minimum width used for filenames.
If you don't specify this, \fBdiffstat\fR uses the length of the longest
filename, after stripping common prefixes.
X.TP
X.B \-V
prints the current version number
X.TP
X.BI \-w " number"
specify the maximum width of the histogram.
The plot will never be shorter than 10 columns, just in case
the filenames get too large.
X.
X.SH ENVIRONMENT
X.PP
\fBDiffstat\fR runs in a portable UNIX\*R environment.
X.SH FILES
X.PP
\fBDiffstat\fR is a single binary module, which uses no auxiliary files.
X.
X.SH BUGS
X.PP
\fBDiffstat\fR makes a lot of assumptions about the format of a \fBdiff\fR file.
X.PP
There's no easy way to determine the degree of overlap between the
"before" and "after" displays of modified lines.
X.
X.SH SEE ALSO
X.PP
diff (1).
X.SH AUTHOR
X.PP
Thomas Dickey (dickey@clark.net).
SHAR_EOF
  $shar_touch -am 1113114294 'diffstat.1' &&
  chmod 0444 'diffstat.1' ||
  echo 'restore of diffstat.1 failed'
  shar_count="`wc -c < 'diffstat.1'`"
  test 2696 -eq "$shar_count" ||
    echo "diffstat.1: original size 2696, current size $shar_count"
fi
# ============= diffstat.c ==============
if test -f 'diffstat.c' && test X"$1" != X"-c"; then
  echo 'x - skipping diffstat.c (file already exists)'
else
  echo 'x - extracting diffstat.c (text)'
  sed 's/^X//' << 'SHAR_EOF' > 'diffstat.c' &&
/******************************************************************************
X * Copyright (c) 1994,1995 by Thomas E. Dickey.  All Rights Reserved.         *
X *                                                                            *
X * You may freely copy or redistribute this software, so long as there is no  *
X * profit made from its use, sale trade or reproduction. You may not change   *
X * this copyright notice, and it must be included in any copy made.           *
X ******************************************************************************/
X
#ifndef	NO_IDENT
static	char	*Id = "$Id: diffstat.c,v 1.17 1995/05/06 14:00:58 tom Exp $";
#endif
X
/*
X * Title:	diffstat.c
X * Author:	T.E.Dickey
X * Created:	02 Feb 1992
X * Modified:
X *		06 May 1995, limit scaling -- only shrink-to-fit.
X *		29 Apr 1995, recognize 'rcsdiff -u' format.
X *		26 Dec 1994, strip common pathname-prefix.
X *		13 Nov 1994, added '-n' option.  Corrected logic of 'match'.
X *		17 Jun 1994, ifdef-<string.h>
X *		12 Jun 1994, recognize unified diff, and output of makepatch.
X *		04 Oct 1993, merge multiple diff-files, busy message when the
X *			     output is piped to a file.
X *
X * Function:	this program reads the output of 'diff' and displays a histogram
X *		of the insertions/deletions/modifications per-file.
X */
X
#include "patchlev.h"
X
#if	defined(HAVE_CONFIG_H)
#include "config.h"
#endif
X
#include <stdio.h>
#include <ctype.h>
X
#if HAVE_STRING_H
#include <string.h>
#else
#include <strings.h>
#define strchr index
#define strrchr rindex
#endif
X
#if HAVE_STDLIB_H
#include <stdlib.h>
#else
extern	int	atoi();
#endif
X
#if HAVE_UNISTD_H
#include <unistd.h>
#else
extern int	isatty();
#endif
X
#if HAVE_MALLOC_H
#include <malloc.h>
#else
extern	char	*malloc();
#endif
X
#if HAVE_GETOPT_H
#include <getopt.h>
#else
extern	int	getopt();
extern	char	*optarg;
extern	int	optind;
#endif
X
#if !defined(TRUE) || (TRUE != 1)
#undef  TRUE
#undef  FALSE
#define	TRUE		1
#define	FALSE		0
#endif
X
#if !defined(EXIT_SUCCESS)
#define EXIT_SUCCESS 0
#define EXIT_FAILURE 1
#endif
X
/******************************************************************************/
X
#define PATHSEP '/'
#define EOS     '\0'
#define BLANK   ' '
X
typedef	enum comment { Normal, Only, Binary } Comment;
X
typedef	struct	_data	{
X	struct	_data	*link;
X	char		*name;
X	Comment		cmt;
X	long		ins,	/* "+" count inserted lines */
X			del,	/* "-" count deleted lines */
X			mod;	/* "!" count modified lines */
X	} DATA;
X
static	DATA	*all_data;
static	int	piped_output;
static	int	max_width;	/* the specified width-limit */
static	int	name_wide;	/* the amount reserved for filenames */
static	int	plot_width;	/* the amount left over for histogram */
static	long	plot_scale;	/* the effective scale (1:maximum) */
X
/******************************************************************************/
#if	__STDC__
static	void	failed (char *s);
static	void	blip (int c);
static	char *	new_string(char *s);
static	DATA *	new_data(char *name);
static	int	match(char *s, char *p);
static	int	version_num(char *s);
static	void	do_file(FILE *fp);
static	long	plot_num(long num_value, int c, long extra);
static	void	summarize(void);
static	void	usage(void);
X	int	main(int argc, char *argv[]);
#endif
/******************************************************************************/
X
static
void	failed(s)
X	char	*s;
{
X	perror(s);
X	exit(EXIT_FAILURE);
}
X
static
void	blip(c)
X	int	c;
{
X	if (piped_output) {
X		(void)fputc(c, stderr);
X		(void)fflush(stderr);
X	}
}
X
static
char *	new_string(s)
X	char	*s;
{
X	return strcpy(malloc((unsigned)(strlen(s)+1)), s);
}
X
static
DATA *	new_data(name)
X	char	*name;
{
X	register DATA *p, *q, *r;
X
X	/* insert into sorted list */
X	for (p = all_data, q = 0; p != 0; q = p, p = p->link) {
X		int	cmp = strcmp(p->name, name);
X		if (cmp == 0)
X			return p;
X		if (cmp > 0) {
X			break;
X		}
X	}
X	r = (DATA *)malloc(sizeof(DATA));
X	if (q != 0)
X		q->link = r;
X	else
X		all_data = r;
X
X	r->link = p;
X	r->name = new_string(name);
X	r->cmt = Normal;
X	r->ins =
X	r->del =
X	r->mod = 0;
X
X	return r;
}
X
/* like strncmp, but without the 3rd argument */
static
int	match(s, p)
X	char	*s;
X	char	*p;
{
X	int	ok = FALSE;
X	while (*s != EOS) {
X		if (*p == EOS) {
X			ok = TRUE;
X			break;
X		}
X		if (*s++ != *p++)
X			break;
X	}
X	return ok;
}
X
static
int	version_num(s)
X	char	*s;
{
X	int	main_ver, sub_ver;
X	char	temp[2];
X	return (sscanf(s, "%d.%d%c", &main_ver, &sub_ver, temp) == 2);
}
X
static
void	do_file(fp)
X	FILE	*fp;
{
X	DATA	dummy, *this = &dummy;
X	char	buffer[BUFSIZ];
X	int	ok = FALSE;
X	register char *s;
X
X	dummy.ins =
X	dummy.del =
X	dummy.mod = 0;
X
X	while (fgets(buffer, sizeof(buffer), fp)) {
X		/*
X		 * Trim trailing blanks (e.g., newline)
X		 */
X		for (s = buffer + strlen(buffer); s > buffer; s--) {
X			if (isspace(s[-1]))
X				s[-1] = EOS;
X			else
X				break;
X		}
X
X		/*
X		 * The markers for unified diff are a little different from the
X		 * normal context-diff.  Also, the edit-lines in a unified diff
X		 * won't have a space in column 2.
X		 */
X		if (match(buffer, "+++ ")
X		 || match(buffer, "--- "))
X		 	(void)strncpy(buffer, "***", 3);
X
X		/*
X		 * Use the first character of the input line to determine its
X		 * type:
X		 */
X		switch (*buffer) {
X		case 'O':	/* Only */
X			if (match(buffer, "Only in ")) {
X				char *path = buffer + 8;
X				int found = FALSE;
X				for (s = path; *s != EOS; s++) {
X					if (match(s, ": ")) {
X						found = TRUE;
X						*s++ = PATHSEP;
X						while ((s[0] = s[1]) != EOS)
X							s++;
X						break;
X					}
X				}
X				if (found) {
X					blip('.');
X					this = new_data(path);
X					this->cmt = Only;
X					ok = TRUE;
X				}
X			}
X			break;
X
X		case 'I':	/* Index (e.g., from makepatch) */
X			if (!match(buffer, "Index: "))
X				break;
X			if ((s = strrchr(buffer, BLANK)) != 0) {
X				blip('.');
X				this = new_data(s+1);
X				ok = TRUE;
X			}
X			break;
X
X		case 'd':	/* diff command trace */
X			if (!match(buffer, "diff "))
X				break;
X			if ((s = strrchr(buffer, BLANK)) != 0) {
X				blip('.');
X				this = new_data(s+1);
X				ok = TRUE;
X			}
X			break;
X
X		case '*':
X			if (ok <= 0) {
X				char	fname[BUFSIZ];
X				char	wday[BUFSIZ], mmm[BUFSIZ];
X				int	ddd, hour, minute, second;
X				int	day, month, year;
X
X				if (sscanf(buffer,
X				    "*** %[^\t]\t%[^ ] %[^ ] %d %d:%d:%d %d",
X				    fname,
X				    wday, mmm, &ddd,
X				    &hour, &minute, &second, &year) == 8
X				|| (sscanf(buffer,
X				    "*** %[^\t]\t%d/%d/%d %d:%d:%d",
X				    	fname,
X					&year, &month, &day,
X					&hour, &minute, &second) == 7
X				  && !version_num(fname))
X				   ) {
X					ok = -TRUE;
X					if (!(s = strrchr(fname, PATHSEP)))
X						s = fname;
X					else
X						s++;
X					this = new_data(s);
X				}
X			}
X			break;
X
X		case '+':
X			if (buffer[1] == buffer[0])
X				break;
X			/* FALL-THRU */
X		case '>':
X			if (!ok)
X				break;
X			this->ins += 1;
X			break;
X
X		case '-':
X			if (!ok)
X				break;
X			if (buffer[1] == buffer[0])
X				break;
X			/* fall-thru */
X		case '<':
X			if (!ok)
X				break;
X			this->del += 1;
X			break;
X
X		case '!':
X			if (!ok)
X				break;
X			this->mod += 1;
X			break;
X
X		case 'B':	/* Binary */
X			/* FALL-THRU */
X		case 'b':	/* binary */
X			if (match(buffer+1, "inary files "))
X				this->cmt = Binary;
X			break;
X		}
X	}
X	blip('\n');
}
X
/*
X * Each call to 'plot_num()' prints a scaled bar of 'c' characters.  The
X * 'extra' parameter is used to keep the accumulated error in the bar's total
X * length from getting large.
X */
static
long	plot_num(num_value, c, extra)
X	long	num_value;	/* the value to plot */
X	int	c;		/* character to display in the bar */
X	long	extra;		/* accumulated error in the bar */
{
X	long	product	= (plot_width * num_value) + extra;
X	long	count	= (product / plot_scale);
X	extra = product - (count * plot_scale);
X	while (--count >= 0)
X		(void)putchar(c);
X	return extra;
}
X
static
void	summarize()
{
X	register DATA *p;
X	long	total_ins = 0,
X		total_del = 0,
X		total_mod = 0,
X		temp;
X	int	num_files = 0,
X		shortest_name = -1,
X		longest_name  = -1,
X		prefix_len    = -1;
X
X	plot_scale = 0;
X	for (p = all_data; p; p = p->link) {
X		int	len = strlen(p->name);
X
X		if (len < prefix_len || prefix_len < 0)
X			prefix_len = len;
X		while (prefix_len > 0) {
X			if (p->name[prefix_len-1] != '/')
X				prefix_len--;
X			else if (strncmp(all_data->name, p->name, prefix_len))
X				prefix_len--;
X			else
X				break;
X		}
X
X		if (len > longest_name)
X			longest_name = len;
X		if (len < shortest_name || shortest_name < 0)
X			shortest_name = len;
X
X		num_files++;
X		total_ins += p->ins;
X		total_del += p->del;
X		total_mod += p->mod;
X		temp = p->ins + p->del + p->mod;
X		if (temp > plot_scale)
X			plot_scale = temp;
X	}
X
X	if (prefix_len < 0)
X		prefix_len = 0;
X	if ((longest_name - prefix_len) > name_wide)
X		name_wide = (longest_name - prefix_len);
X
X	name_wide++;	/* make sure it's nonzero */
X	plot_width = (max_width - name_wide - 8);
X	if (plot_width < 10)
X		plot_width = 10;
X	
X	if (plot_scale < plot_width)
X		plot_scale = plot_width;	/* 1:1 */
X
X	for (p = all_data; p; p = p->link) {
X		printf(" %-*.*s|", name_wide, name_wide, p->name + prefix_len);
X		if (p->cmt == Normal) {
X			long	errs = 0;
X			printf("%5ld ", p->ins + p->del + p->mod);
X			errs = plot_num(p->ins, '+', errs);
X			(void) plot_num(p->del, '-', errs);
X			(void) plot_num(p->mod, '!', errs);
X		} else if (p->cmt == Binary) {
X			printf("binary");
X		} else if (p->cmt == Only) {
X			printf("only");
X		}
X		printf("\n");
X	}
X
X	printf(" %d files changed", num_files);
X	if (total_ins) printf(", %ld insertions", total_ins);
X	if (total_del) printf(", %ld deletions", total_del);
X	if (total_mod) printf(", %ld modifications", total_mod);
X	(void)putchar('\n');
}
X
static
void	usage()
{
X	static	char	*msg[] = {
X	"Usage: diffstat [options] [files]",
X	"",
X	"Reads from one or more input files which contain output from 'diff',",
X	"producing a histogram of total lines changed for each file referenced.",
X	"If no filename is given on the command line, reads from stdin.",
X	"",
X	"Options:",
X	"  -n NUM  specify minimum width for the filenames (default: auto)",
X	"  -w NUM  specify maximum width of the output (default: 80)",
X	"  -V      prints the version number"
X	};
X	register int j;
X	for (j = 0; j < sizeof(msg)/sizeof(msg[0]); j++)
X		fprintf(stderr, "%s\n", msg[j]);
X	exit (EXIT_FAILURE);
}
X
int	main(argc, argv)
X	int	argc;
X	char	*argv[];
{
X	register int	j;
X	char	version[80];
X
X	max_width = 80;
X	piped_output = !isatty(fileno(stdout))
X		     && isatty(fileno(stderr));
X
X	while ((j = getopt(argc, argv, "n:w:V")) != EOF) {
X		switch (j) {
X		case 'n':
X			name_wide = atoi(optarg);
X			break;
X		case 'w':
X			max_width = atoi(optarg);
X			break;
X		case 'V':
X			if (!sscanf(Id, "%*s %*s %s", version))
X				(void)strcpy(version, "?");
X			printf("diffstat version %s (patch %d)\n",
X				version,
X				PATCHLEVEL);
X			exit(EXIT_SUCCESS);
X		default:
X			usage();
X			/*NOTREACHED*/
X		}
X	}
X
X	if (optind < argc) {
X		while (optind < argc) {
X			FILE *fp;
X			char *name = argv[optind++];
X			if ((fp = fopen(name, "r")) != 0) {
X				if (piped_output) {
X					(void)fprintf(stderr, "%s\n", name);
X					(void)fflush(stderr);
X				}
X				do_file(fp);
X			} else {
X				failed(name);
X			}
X		}
X	} else {
X		do_file(stdin);
X	}
X	summarize();
X	exit(EXIT_SUCCESS);
X	/*NOTREACHED*/
X	return (EXIT_SUCCESS);
}
SHAR_EOF
  $shar_touch -am 0506070095 'diffstat.c' &&
  chmod 0444 'diffstat.c' ||
  echo 'restore of diffstat.c failed'
  shar_count="`wc -c < 'diffstat.c'`"
  test 11122 -eq "$shar_count" ||
    echo "diffstat.c: original size 11122, current size $shar_count"
fi
# ============= install.sh ==============
if test -f 'install.sh' && test X"$1" != X"-c"; then
  echo 'x - skipping install.sh (file already exists)'
else
  echo 'x - extracting install.sh (text)'
  sed 's/^X//' << 'SHAR_EOF' > 'install.sh' &&
#!/bin/sh
#
# install - install a program, script, or datafile
# This comes from X11R5.
#
# Calling this script install-sh is preferred over install.sh, to prevent
# `make' implicit rules from creating a file called install from it
# when there is no Makefile.
#
# This script is compatible with the BSD install script, but was written
# from scratch.
#
X
X
# set DOITPROG to echo to test this script
X
# Don't use :- since 4.3BSD and earlier shells don't like it.
doit="${DOITPROG-}"
X
X
# put in absolute paths if you don't have them in your path; or use env. vars.
X
mvprog="${MVPROG-mv}"
cpprog="${CPPROG-cp}"
chmodprog="${CHMODPROG-chmod}"
chownprog="${CHOWNPROG-chown}"
chgrpprog="${CHGRPPROG-chgrp}"
stripprog="${STRIPPROG-strip}"
rmprog="${RMPROG-rm}"
mkdirprog="${MKDIRPROG-mkdir}"
X
tranformbasename=""
transform_arg=""
instcmd="$mvprog"
chmodcmd="$chmodprog 0755"
chowncmd=""
chgrpcmd=""
stripcmd=""
rmcmd="$rmprog -f"
mvcmd="$mvprog"
src=""
dst=""
dir_arg=""
X
while [ x"$1" != x ]; do
X    case $1 in
X	-c) instcmd="$cpprog"
X	    shift
X	    continue;;
X
X	-d) dir_arg=true
X	    shift
X	    continue;;
X
X	-m) chmodcmd="$chmodprog $2"
X	    shift
X	    shift
X	    continue;;
X
X	-o) chowncmd="$chownprog $2"
X	    shift
X	    shift
X	    continue;;
X
X	-g) chgrpcmd="$chgrpprog $2"
X	    shift
X	    shift
X	    continue;;
X
X	-s) stripcmd="$stripprog"
X	    shift
X	    continue;;
X
X	-t=*) transformarg=`echo $1 | sed 's/-t=//'`
X	    shift
X	    continue;;
X
X	-b=*) transformbasename=`echo $1 | sed 's/-b=//'`
X	    shift
X	    continue;;
X
X	*)  if [ x"$src" = x ]
X	    then
X		src=$1
X	    else
X		# this colon is to work around a 386BSD /bin/sh bug
X		:
X		dst=$1
X	    fi
X	    shift
X	    continue;;
X    esac
done
X
if [ x"$src" = x ]
then
X	echo "install:	no input file specified"
X	exit 1
else
X	true
fi
X
if [ x"$dir_arg" != x ]; then
X	dst=$src
X	src=""
X	
X	if [ -d $dst ]; then
X		instcmd=:
X	else
X		instcmd=mkdir
X	fi
else
X
# Waiting for this to be detected by the "$instcmd $src $dsttmp" command
# might cause directories to be created, which would be especially bad 
# if $src (and thus $dsttmp) contains '*'.
X
X	if [ -f $src -o -d $src ]
X	then
X		true
X	else
X		echo "install:  $src does not exist"
X		exit 1
X	fi
X	
X	if [ x"$dst" = x ]
X	then
X		echo "install:	no destination specified"
X		exit 1
X	else
X		true
X	fi
X
# If destination is a directory, append the input filename; if your system
# does not like double slashes in filenames, you may need to add some logic
X
X	if [ -d $dst ]
X	then
X		dst="$dst"/`basename $src`
X	else
X		true
X	fi
fi
X
## this sed command emulates the dirname command
dstdir=`echo $dst | sed -e 's,[^/]*$,,;s,/$,,;s,^$,.,'`
X
# Make sure that the destination directory exists.
#  this part is taken from Noah Friedman's mkinstalldirs script
X
# Skip lots of stat calls in the usual case.
if [ ! -d "$dstdir" ]; then
defaultIFS='	
'
IFS="${IFS-${defaultIFS}}"
X
oIFS="${IFS}"
# Some sh's can't handle IFS=/ for some reason.
IFS='%'
set - `echo ${dstdir} | sed -e 's@/@%@g' -e 's@^%@/@'`
IFS="${oIFS}"
X
pathcomp=''
X
while [ $# -ne 0 ] ; do
X	pathcomp="${pathcomp}${1}"
X	shift
X
X	if [ ! -d "${pathcomp}" ] ;
X        then
X		$mkdirprog "${pathcomp}"
X	else
X		true
X	fi
X
X	pathcomp="${pathcomp}/"
done
fi
X
if [ x"$dir_arg" != x ]
then
X	$doit $instcmd $dst &&
X
X	if [ x"$chowncmd" != x ]; then $doit $chowncmd $dst; else true ; fi &&
X	if [ x"$chgrpcmd" != x ]; then $doit $chgrpcmd $dst; else true ; fi &&
X	if [ x"$stripcmd" != x ]; then $doit $stripcmd $dst; else true ; fi &&
X	if [ x"$chmodcmd" != x ]; then $doit $chmodcmd $dst; else true ; fi
else
X
# If we're going to rename the final executable, determine the name now.
X
X	if [ x"$transformarg" = x ] 
X	then
X		dstfile=`basename $dst`
X	else
X		dstfile=`basename $dst $transformbasename | 
X			sed $transformarg`$transformbasename
X	fi
X
# don't allow the sed command to completely eliminate the filename
X
X	if [ x"$dstfile" = x ] 
X	then
X		dstfile=`basename $dst`
X	else
X		true
X	fi
X
# Make a temp file name in the proper directory.
X
X	dsttmp=$dstdir/#inst.$$#
X
# Move or copy the file name to the temp name
X
X	$doit $instcmd $src $dsttmp &&
X
X	trap "rm -f ${dsttmp}" 0 &&
X
# and set any options; do chmod last to preserve setuid bits
X
# If any of these fail, we abort the whole thing.  If we want to
# ignore errors from any of these, just make sure not to ignore
# errors from the above "$doit $instcmd $src $dsttmp" command.
X
X	if [ x"$chowncmd" != x ]; then $doit $chowncmd $dsttmp; else true;fi &&
X	if [ x"$chgrpcmd" != x ]; then $doit $chgrpcmd $dsttmp; else true;fi &&
X	if [ x"$stripcmd" != x ]; then $doit $stripcmd $dsttmp; else true;fi &&
X	if [ x"$chmodcmd" != x ]; then $doit $chmodcmd $dsttmp; else true;fi &&
X
# Now rename the file to the real destination.
X
X	$doit $rmcmd -f $dstdir/$dstfile &&
X	$doit $mvcmd $dsttmp $dstdir/$dstfile 
X
fi &&
X
X
Xexit 0
SHAR_EOF
  $shar_touch -am 0912213294 'install.sh' &&
  chmod 0555 'install.sh' ||
  echo 'restore of install.sh failed'
  shar_count="`wc -c < 'install.sh'`"
  test 4771 -eq "$shar_count" ||
    echo "install.sh: original size 4771, current size $shar_count"
fi
# ============= makefile.in ==============
if test -f 'makefile.in' && test X"$1" != X"-c"; then
  echo 'x - skipping makefile.in (file already exists)'
else
  echo 'x - extracting makefile.in (text)'
  sed 's/^X//' << 'SHAR_EOF' > 'makefile.in' &&
# $Id: makefile.in,v 1.8 1994/11/13 19:46:59 tom Exp $
# Makefile-template for 'diffstat'
X
THIS = diffstat
X
#### Start of system configuration section. ####
X
srcdir = @srcdir@
VPATH  = @srcdir@
X
CC		= @CC@
LINK		= $(CC)
INSTALL		= @INSTALL@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@
INSTALL_DATA	= @INSTALL_DATA@
X
LIBS		= @LIBS@
CFLAGS		= @CFLAGS@
LDFLAGS		=
X
prefix		= @prefix@
exec_prefix	= @exec_prefix@
X
bindir		= $(exec_prefix)/bin
libdir		= $(exec_prefix)/lib
mandir		= $(prefix)/man/man1
manext		= 1
X
#### End of system configuration section. ####
X
SHELL		= /bin/sh
X
CPPFLAGS	= -I. -I$(srcdir) -DHAVE_CONFIG_H
X
LDFLAGS		= 
X
X.c.o:
X	$(CC) -c $(CPPFLAGS) $(CFLAGS) $<
X
SRC = CHANGES patchlev.h \
X	README $(THIS).c $(THIS).1 \
X	config_h.in install.sh mkdirs.sh makefile.in configure.in
X
OBJ = $(THIS).o
X
DISTFILES = configure $(SRC)
X
all:	$(THIS)
X
$(THIS): $(OBJ)
X	-mv $(THIS) o$(THIS)
X	$(LINK) $(LDFLAGS) -o $(THIS) $(OBJ) $(LIBS)
X
install: all installdirs
X	$(INSTALL_PROGRAM) $(THIS) $(bindir)/$(THIS)
X	$(INSTALL_DATA) $(srcdir)/$(THIS).1 $(mandir)/$(THIS).$(manext)
X
installdirs:
X	$(SHELL) ${srcdir}/mkdirs.sh $(bindir) $(libdir) $(mandir)
X
uninstall:
X	rm -f $(bindir)/$(THIS) $(mandir)/$(THIS).$(manext)
X
makefile: makefile.in config.status
X	./config.status
X
config.h: configure
X	./configure
X
config.status: configure
X	./config.status --recheck
X
mostlyclean:
X	rm -f *.o o$(THIS) core *~ *.BAK
X
clean: mostlyclean
X	rm -f $(THIS)
X
distclean: clean
X	rm -f makefile config.log config.cache config.status config.h
X
realclean: distclean
X	rm -f tags TAGS # don't remove configure!
X
lint:
X	lint $(THIS).c
X
tags:
X	ctags $(THIS).c $(HDRS)
X
TAGS:
X	etags $(THIS).c $(HDRS)
X
dist:	makefile $(DISTFILES)
X	echo $(THIS)-`sed \
X		-e '/"$$[A-Za-z]*: $(THIS)\.c.*$$"/!d' \
X		-e 's/^.*$(THIS)[^ ]*[ ]*//' \
X		-e 's/[ ].*$$//' \
X		-e q $(srcdir)/$(THIS).c` > .fname
X	rm -rf `cat .fname`
X	mkdir `cat .fname`
X	for file in $(DISTFILES); do \
X	  ln $(srcdir)/$$file `cat .fname` \
X	    || { echo copying $$file instead; cp -p $$file `cat .fname`; }; \
X	done
X	tar -cf - `cat .fname` | gzip >`cat .fname`.tgz
X	rm -rf `cat .fname` .fname
X
shar:	$(DISTFILES)
X	shar -a -m -M -L50 -n$(THIS) -oPart $(DISTFILES)
X
$(THIS).o:	config.h
X
$(SRC):	; checkout $@
SHAR_EOF
  $shar_touch -am 1113114694 'makefile.in' &&
  chmod 0444 'makefile.in' ||
  echo 'restore of makefile.in failed'
  shar_count="`wc -c < 'makefile.in'`"
  test 2225 -eq "$shar_count" ||
    echo "makefile.in: original size 2225, current size $shar_count"
fi
# ============= mkdirs.sh ==============
if test -f 'mkdirs.sh' && test X"$1" != X"-c"; then
  echo 'x - skipping mkdirs.sh (file already exists)'
else
  echo 'x - extracting mkdirs.sh (text)'
  sed 's/^X//' << 'SHAR_EOF' > 'mkdirs.sh' &&
#!/bin/sh
# mkinstalldirs --- make directory hierarchy
# Author: Noah Friedman <friedman@prep.ai.mit.edu>
# Created: 1993-05-16
# Last modified: 1994-03-25
# Public domain
X
errstatus=0
X
for file in ${1+"$@"} ; do 
X   set fnord `echo ":$file" | sed -ne 's/^:\//#/;s/^://;s/\// /g;s/^#/\//;p'`
X   shift
X
X   pathcomp=
X   for d in ${1+"$@"} ; do
X     pathcomp="$pathcomp$d"
X     case "$pathcomp" in
X       -* ) pathcomp=./$pathcomp ;;
X     esac
X
X     if test ! -d "$pathcomp"; then
X        echo "mkdir $pathcomp" 1>&2
X        mkdir "$pathcomp" || errstatus=$?
X     fi
X
X     pathcomp="$pathcomp/"
X   done
done
X
exit $errstatus
X
# mkinstalldirs ends here
SHAR_EOF
  $shar_touch -am 0521110894 'mkdirs.sh' &&
  chmod 0555 'mkdirs.sh' ||
  echo 'restore of mkdirs.sh failed'
  shar_count="`wc -c < 'mkdirs.sh'`"
  test 649 -eq "$shar_count" ||
    echo "mkdirs.sh: original size 649, current size $shar_count"
fi
# ============= patchlev.h ==============
if test -f 'patchlev.h' && test X"$1" != X"-c"; then
  echo 'x - skipping patchlev.h (file already exists)'
else
  echo 'x - extracting patchlev.h (text)'
  sed 's/^X//' << 'SHAR_EOF' > 'patchlev.h' &&
#define PATCHLEVEL 3
SHAR_EOF
  $shar_touch -am 0506070095 'patchlev.h' &&
  chmod 0444 'patchlev.h' ||
  echo 'restore of patchlev.h failed'
  shar_count="`wc -c < 'patchlev.h'`"
  test 21 -eq "$shar_count" ||
    echo "patchlev.h: original size 21, current size $shar_count"
fi
exit 0
