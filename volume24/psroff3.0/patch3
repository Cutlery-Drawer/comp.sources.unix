Subject:  v24i117:  psroff, Troff to PostScript filter, Patch3
Newsgroups: comp.sources.unix
Approved: rsalz@uunet.UU.NET

Submitted-by: Chris Lewis <clewis@ferret.ocunix.on.ca>
Posting-number: Volume 24, Issue 117
Archive-name: psroff3.0/patch3

    This is official patch 03 for Psroff 3.0.
    Please apply it by:
	cd <psroff source directory>
	patch -N -p < <this file>

A bit hefty, but these patches are almost entirely build documentation
fixes:
	- magic incantation for successfull builds on Ultrix (VAX/MIPS)
	- rewrote Apollo documentation somewhat.
	- "Type Director" - source for HP fonts.
	- "zap" program for building on systems without System V make.
	  Eg: "vanilla" BSD or Sony.  (see MISC file)
	- made psxlate know that BeginData and EndData nest in
	  Postscript DSC.  (already does {Begin|End}Document)
	- made sure that postscript include mechanism searches "./lib"
	  in addition to . and FONTDIR/lib.  (caused can't include
	  confid.ps error message if you tried to run psroff without
	  installing)
	- made non-fatal build messages sound less fatal.
	- additional lookup for ftR when trying to fake headers on
	  constructed width tables.
	- Documented -n<page>,<page> page selectcion option in psxlate.

./man/Makefile		Made "Where does cat man page go?" message
			sound "less fatal".
./man/psxlate.1.S	Made docs consistent with program. (where did -N
			come from?)
./lib/psrofflib.S	xtfull alternative xtroff invocation.
./widths/dit2catwid.c	When FONTDIR different from /usr/lib/font, AND
			you need *real* object headers (eg: Apollo),
			dit2catwid didn't look in /usr/lib/font for
			original ftR to copy headers and trailers from.
./widths/installdit.S	Made missing makedev/mkfont less fatal sounding.
./utils/psxlate.c	{Begin|End}Data nesting (in addition to
			{Begin|End}Document)
./README		Ultrix clarification, "zap", etc.
./MISC			Ultrix clarification, "zap", crummy makes.
./defs.h		patch level, dropped "COFF" define (doesn't
			work, not needed)
./INSTALL		Ultrix clarification etc.
./TROUBLE		Ultrix clarification/Apollo notes etc.
./LJIII			HP font sources, how to make width tables for new
			scalable fonts.
./Makefile		Ultrix MAKE/SHELL comments.  Missing $(MAKE)'s
./audit.S		Pump out version and patch level.
./utils.c		Added ./lib to include search path.
./zap			Kludge-around crummy makes.
./LASERFONTS		HP font sources.

Index: ./man/Makefile
*** /tmp/PATCHold/./man/Makefile	Sat Jul 27 12:44:18 1991
--- ./man/Makefile	Sat Jul 27 12:44:20 1991
***************
*** 1,4 ****
! # 2.4 91/03/25
  
  MANPAGES = troff2ps.1 psroff.1 cat.5 pk2sfp.1 dumpft.1 hpinterp.1 \
  	asc2ps.1 psxlate.1
--- 1,4 ----
! # 2.5 91/07/20
  
  MANPAGES = troff2ps.1 psroff.1 cat.5 pk2sfp.1 dumpft.1 hpinterp.1 \
  	asc2ps.1 psxlate.1
***************
*** 32,36 ****
  	    echo "Installing cat.5 in $(MANDIR)/../man5/cat.5" ; \
  	    cp cat.5 $(MANDIR)/../man5/cat.5 ; \
  	else \
! 	    echo "Can't figure out where to install cat.5 - do it yourself" ; \
  	fi
--- 32,38 ----
  	    echo "Installing cat.5 in $(MANDIR)/../man5/cat.5" ; \
  	    cp cat.5 $(MANDIR)/../man5/cat.5 ; \
  	else \
! 	    echo "Can't figure out where to install cat.5 - do it yourself." ; \
! 	    echo "(install cat.5 in the directory where your manual page system" ; \
! 	    echo "stores file format manual pages" ; \
  	fi
Index: ./man/psxlate.1.S
*** /tmp/PATCHold/./man/psxlate.1.S	Sat Jul 27 12:44:32 1991
--- ./man/psxlate.1.S	Sat Jul 27 12:44:33 1991
***************
*** 1,4 ****
! .\"Copyright 1991 by Chris Lewis 2.7 91/03/25
  .TH PSXLATE %%MANEXT%% "Psroff %%T2VERSION%%"
  .SH NAME
  psxlate \- General Postscript page flipper etcetera
--- 1,4 ----
! .\"Copyright 1991 by Chris Lewis 2.8 91/07/11
  .TH PSXLATE %%MANEXT%% "Psroff %%T2VERSION%%"
  .SH NAME
  psxlate \- General Postscript page flipper etcetera
***************
*** 9,15 ****
  .BI "[\-s" n "]"
  .B "[\-d]"
  .B "[\-B|E]"
! .BI "[\-N" "a,b,c" "]"
  .BI "[\-n" "a,a\-b,..." "]"
  .BI "<" input file
  .BI ">" output file
--- 9,16 ----
  .BI "[\-s" n "]"
  .B "[\-d]"
  .B "[\-B|E]"
! .\"Now why did I put in a -N option?
! .\".BI "[\-N" "a,b,c" "]"
  .BI "[\-n" "a,a\-b,..." "]"
  .BI "<" input file
  .BI ">" output file
***************
*** 78,83 ****
--- 79,98 ----
  The
  .B \-d
  option enables debugging.
+ .PP
+ The
+ .B \-n
+ option permits you to select specific pages for printing.
+ You can specify pages or ranges of pages.
+ Ie: \-n4,5,20-25
+ Selects the fourth, fifth and 20th thru 25th pages for printing.
+ Note that this code does not pay any attention to the contents of
+ the "%%Page:" comment, and simply selects the pages according to the
+ order
+ .I psxlate
+ sees them.
+ If the second part of a range is omitted, it means to the end of the document.
+ If the first part of a range is omitted, it means from the beginning of the document.
  .PP
  The other options,
  .BR r ,
Index: ./lib/psrofflib.S
*** /tmp/PATCHold/./lib/psrofflib.S	Sat Jul 27 12:44:45 1991
--- ./lib/psrofflib.S	Sat Jul 27 12:44:46 1991
***************
*** 1,4 ****
! #	2.18 91/04/25
  #	This file controls psroff, you can insert additional printer
  #	types here.  These are eval'd *late* in processing, so that
  #	you can insert $copies etc.
--- 1,4 ----
! #	2.19 91/07/27
  #	This file controls psroff, you can insert additional printer
  #	types here.  These are eval'd *late* in processing, so that
  #	you can insert $copies etc.
***************
*** 168,181 ****
  
  #	X.11 Xtroff using supplied ps width tables
  #
! #	You should probably run xtroff's devpsc ditroff width tables
! #	through gfttab ("cd widths; gfnttab /usr/lib/font/devpsc psc" ?)
! #	and change width to psc.  However, the default "ps" tables work
! #	pretty well.  A few characters in CAT troff do not print as you
! #	would expect: ^, @, \(ga, \(em, \(dg, \(bs, \(eq.  Some of these
! #	may have been fixed in your version of xtroff (patch 10).
  
  xt	width=ps t2arg='-Tdt -dpsc' lparg='| xtroff'
  
  #	Adobe Transcript psdit - this appears to work, but I've not
  #	set a workable lparg.  A number of characters are missing:
--- 168,185 ----
  
  #	X.11 Xtroff using supplied ps width tables
  #
! #	You should use the same width tables in the width= line
! #	as you are printing with.  This way you get xtroff output
! #	to agree closely with character placement on the printer.
! #	Even if it does look ugly.  A few characters on xtroff don't
! #	print as you expect:
! #	  ^, @, \(ga, \(em, \(dg, \(bs, \(eq.
! #	Some of these may have been fixed in your version of xtroff.
! #	Patch 10 is recommended.  If you have an earlier one, define
! #	NOCHATTER in defs.h.  Try -Txtfull too and see if it improves things.
  
  xt	width=ps t2arg='-Tdt -dpsc' lparg='| xtroff'
+ xtfull	width=ps t2arg='-Tdt -dpsc' lparg='| xtroff -full'
  
  #	Adobe Transcript psdit - this appears to work, but I've not
  #	set a workable lparg.  A number of characters are missing:
Index: ./widths/dit2catwid.c
*** /tmp/PATCHold/./widths/dit2catwid.c	Sat Jul 27 12:44:57 1991
--- ./widths/dit2catwid.c	Sat Jul 27 12:45:02 1991
***************
*** 10,16 ****
  
  #ifndef	lint
  static char SCCSID[] =
!     "@(#)dit2catwid.c 2.8 Copyright 91/04/25 17:29:41 Chris Lewis";
  #endif
  
  #include <stdio.h>
--- 10,16 ----
  
  #ifndef	lint
  static char SCCSID[] =
!     "@(#)dit2catwid.c 2.9 Copyright 91/07/27 12:36:15 Chris Lewis";
  #endif
  
  #include <stdio.h>
***************
*** 238,245 ****
  
      if (headersize != 0) {
  	char buf[128];
! 	sprintf(buf, "%s/%s", FONTDIR, "ftR");
! 	if (of = fopen(buf, "r")) {
  	    for (i = 0; i < headersize; i++)
  		fputc(fgetc(of), f);
  	    for (i = 0; i < 224; i++)
--- 238,250 ----
  
      if (headersize != 0) {
  	char buf[128];
! 	of = fopen("/usr/lib/font/ftR", "r");
! 	if (!of) {
! 	    sprintf(buf, "%s/%s", FONTDIR, "ftR");
! 	    of = fopen(buf, "r");
! 	}
! 	if (of) {
! 	    
  	    for (i = 0; i < headersize; i++)
  		fputc(fgetc(of), f);
  	    for (i = 0; i < 224; i++)
Index: ./widths/installdit.S
*** /tmp/PATCHold/./widths/installdit.S	Sat Jul 27 12:45:24 1991
--- ./widths/installdit.S	Sat Jul 27 12:45:28 1991
***************
*** 5,15 ****
  #    See the LICENSE file for a full description of the restrictions
  #    under which this software is provided.
  #
! #1.4 91/04/02
  MAKEDEV=%%MAKEDEV%%
  if [ ! -f "$MAKEDEV" ]
  then
!     echo "no $MAKEDEV program"
      exit 0
  fi
  if [ "$1" = "-i" ]
--- 5,16 ----
  #    See the LICENSE file for a full description of the restrictions
  #    under which this software is provided.
  #
! #1.5 91/07/20
  MAKEDEV=%%MAKEDEV%%
  if [ ! -f "$MAKEDEV" ]
  then
!     echo "no $MAKEDEV program - don't worry unless you're using psroff"
!     echo "with REAL ditroff instead of C/A/T troff"
      exit 0
  fi
  if [ "$1" = "-i" ]
Index: ./utils/psxlate.c
*** /tmp/PATCHold/./utils/psxlate.c	Sat Jul 27 12:45:48 1991
--- ./utils/psxlate.c	Sat Jul 27 12:45:54 1991
***************
*** 23,29 ****
   */
  #ifndef	lint
  static char SCCSid[] =
!     "@(#)psxlate.c: 2.13 Copyright 91/04/24 22:07:02 Chris Lewis";
  #endif
  
  #ifdef	ALONE
--- 23,29 ----
   */
  #ifndef	lint
  static char SCCSid[] =
!     "@(#)psxlate.c: 2.15 Copyright 91/07/24 23:17:49 Chris Lewis";
  #endif
  
  #ifdef	ALONE
***************
*** 243,253 ****
--- 243,259 ----
  
  		if (strncmp(buffer, "%%BeginDocument:", 16) == 0)
  		    nest++;
+ 		else if (strncmp(buffer, "%%BeginData:", 12) == 0)
+ 		    nest++;
+ 		else if (isspace(buffer[9]) &&
+ 		    strncmp(buffer, "%%EndData", 9) == 0)
+ 		    nest--;
  		else if (isspace(buffer[13]) &&
  		    strncmp(buffer, "%%EndDocument", 13) == 0)
  		    nest--;
  
  		seen = S_NONE;
+ 
  	    }
  	} else
  	    seen = S_NONE;
***************
*** 270,276 ****
  		fclose(out);
  		if (psnupwanted)
  		    append(pages);
! 		return;
  	    case S_PAGE:
  		switch(state) {
  		    case PROLOG:
--- 276,282 ----
  		fclose(out);
  		if (psnupwanted)
  		    append(pages);
! 		goto endit;
  	    case S_PAGE:
  		switch(state) {
  		    case PROLOG:
***************
*** 305,310 ****
--- 311,317 ----
  		break;
  	}
      }
+ endit:
      if (nest) {
  	fprintf(stderr, "%s: misnested BeginDocument/EndDocument\n",
  	    progname);
***************
*** 592,616 ****
      register char *p = s;
      int tmp = 0;
      ranges[ri].end = -1;
!     while (isdigit(*s))
! 	tmp = 10 * tmp + (*s++ - '0');
!     if (tmp <= 0) {
! 	fprintf(stderr, "%s: bad number %s\n", progname, p);
! 	exit(1);
      }
      ranges[ri].end = ranges[ri].start = tmp;
      if (*s == '-') {
  	s++;
  	p = s;
  	tmp = 0;
! 	while(isdigit(*s))
! 	    tmp = 10 * tmp + (*s++ - '0');
! 	if (tmp <= 0) {
! 	    fprintf(stderr, "%s: bad number %s\n", progname, p);
! 	    exit(1);
  	}
  	ranges[ri].end = tmp;
      }
      if (*s == ',')
  	s++;
      ri++;
--- 599,635 ----
      register char *p = s;
      int tmp = 0;
      ranges[ri].end = -1;
! 
!     if (*s == '-')
! 	tmp = 1;
!     else {
! 	while (isdigit(*s))
! 	    tmp = 10 * tmp + (*s++ - '0');
! 	if (tmp <= 0) {
! 	    fprintf(stderr, "%s: bad number %s\n", progname, p);
! 	    exit(1);
! 	}
      }
+ 
      ranges[ri].end = ranges[ri].start = tmp;
+ 
      if (*s == '-') {
  	s++;
  	p = s;
  	tmp = 0;
! 	if (*s == ',' || *s == '\0')
! 	    tmp = 100000;
! 	else {
! 	    while(isdigit(*s))
! 		tmp = 10 * tmp + (*s++ - '0');
! 	    if (tmp <= 0) {
! 		fprintf(stderr, "%s: bad number %s\n", progname, p);
! 		exit(1);
! 	    }
  	}
  	ranges[ri].end = tmp;
      }
+ 
      if (*s == ',')
  	s++;
      ri++;
Index: ./README
*** /tmp/PATCHold/./README	Sat Jul 27 12:46:10 1991
--- ./README	Sat Jul 27 12:46:13 1991
***************
*** 1,4 ****
! 		PSROFF RELEASE 3.0 README 2.19 91/04/24
  
  			Feb 19, 1991
  			Chris Lewis
--- 1,4 ----
! 		PSROFF RELEASE 3.0 README 2.20 91/07/20
  
  			Feb 19, 1991
  			Chris Lewis
***************
*** 212,219 ****
  	      lj3.fonts file (has the encodings and font selections)
  
  	      See the LJIII file for more information on how the LJIII
! 	      variant works, and some pointers on how to upgrade your pre-LJIII
! 	      printers to work as well.
  
  	  Psroff supports both PK and SFP format font files.
  	  Normal PK font files (eg: that come with TeX) do not have
--- 212,220 ----
  	      lj3.fonts file (has the encodings and font selections)
  
  	      See the LJIII file for more information on how the LJIII
! 	      variant works, some pointers on how to upgrade your pre-LJIII
! 	      printers to work as well, and some more information on
! 	      Type Director.
  
  	  Psroff supports both PK and SFP format font files.
  	  Normal PK font files (eg: that come with TeX) do not have
Index: ./MISC
*** /tmp/PATCHold/./MISC	Sat Jul 27 12:46:32 1991
--- ./MISC	Sat Jul 27 12:46:34 1991
***************
*** 1,5 ****
  		Miscellaneous Tuning/Customization
! 			2.10 91/05/10
  
      - Vertical bars in eqn may not be vertical.  This is a botch
        in some versions of eqn - namely, eqn is asking for "|"
--- 1,5 ----
  		Miscellaneous Tuning/Customization
! 			2.13 91/07/23
  
      - Vertical bars in eqn may not be vertical.  This is a botch
        in some versions of eqn - namely, eqn is asking for "|"
***************
*** 18,26 ****
  	normal
  	| 0
  
!       to the appropriate *.lib file.  Then all "|" will be
        from the Times-Roman font.  Ugly, but the only way to
        fix eqn vertical bars.
      - Postscript spooling:  Theoretically speaking, it is better
        to have psxlate in your Postscript printer spooler interface
        than as a pipeline in psroff.  For System V, you might want
--- 18,63 ----
  	normal
  	| 0
  
!       to the appropriate *.fonts file.  Then all "|" will be
        from the Times-Roman font.  Ugly, but the only way to
        fix eqn vertical bars.
+ 
+     - Broken Makes: There are two things that could be wrong
+       with your version of make.  One is that it doesn't support
+       "include".  This can be fixed by uncommenting the "MAKE ="
+       line in the Makefile that contains the sed script.  The
+       other thing is that older versions of make (eg: vanilla
+       BSD, Sony) don't understand some of the additional features
+       of the System V Extended Make.  If you have the latter, do
+       the following to build psroff:
+ 
+ 	    1) Edit Makefile/defs.h/psrofflib.S to suit
+ 	    2) Type:
+ 		chmod 755 zap
+ 		./zap
+ 		make (this will abort in the widths subdirectory
+ 		      immediately after removing some .log files)
+ 		./zap foo (will create the width tables)
+       
+       After this, a "make install" should work, but a "make
+       installwidths" won't.  You will have to copy the ft* files
+       from each widths/widthXX directory to a directory FONTDIR/XX.
+       (Where FONTDIR will probably be /usr/lib/font)
+ 
+       If you change the configuration of psroff: defs.h, Makefile,
+       or any .S file, you will have to run "./zap" and "make"
+       again.
+     
+       The zap program doesn't do everything - namely it doesn't
+       produce the HP Laserjet width tables from existing fonts,
+       nor will it generate ditroff width tables if you're trying
+       to use real ditroff instead of C/A/T troff.  If you need
+       to do this, please contact me and I'll help.
+ 
+       Zap merely runs thru all of the .S files substituting
+       the appropriate parameters to create the files you use.
+       (eg: transforming lib/psrofflib.S to lib/psrofflib)
+ 
      - Postscript spooling:  Theoretically speaking, it is better
        to have psxlate in your Postscript printer spooler interface
        than as a pipeline in psroff.  For System V, you might want
Index: ./defs.h
*** /tmp/PATCHold/./defs.h	Sat Jul 27 12:46:49 1991
--- ./defs.h	Sat Jul 27 12:46:50 1991
***************
*** 9,15 ****
   */
  
  /*	Official Release and Patch level:	*/
! #define	T2VERSION	"@(#)PSROFF Copyright 91/05/28 Chris Lewis - R3 PL2"
  
  /*	Configuration parameters:
   */
--- 9,15 ----
   */
  
  /*	Official Release and Patch level:	*/
! #define	T2VERSION	"@(#)PSROFF Copyright 91/07/23 Chris Lewis - R3 PL3"
  
  /*	Configuration parameters:
   */
***************
*** 47,55 ****
  	  compiled font width table.  HEADERSIZE 0 is the correct definition
  	  for Xenix and most System V [o]troffs.  HEADERSIZE=32 works for Ultrix
  	  (except RISC, see below).  HEADERSIZE=32 works properly for most Suns.
- 	- If COFF is defined instead, use a COFF header on the beginning of
- 	  the file.  I personally know of no machine that supports these, tho,
- 	  there's unconfirmed rumours that Apollo systems might.
  	- If neither are defined, use a BSD/V7 style a.out.h header, this
  	  is appropriate for V7 and BSD troffs
  	- If you are running RISC/Ultrix (Mips box? from DEC) define
--- 47,52 ----
***************
*** 65,72 ****
   */
  
  #define	HEADERSIZE 0	/* size of header in bytes */
- #undef	COFF		/* systems using COFF headers - See TROUBLE file
- 			   about Apollos */
  #undef	ASCIIWIDTHS	/* For RISC/Ultrix */
  
  /* What do your CAT codes look like?
--- 62,67 ----
***************
*** 100,106 ****
   */
  #undef	NOCONTROLD
  
! /*	define if you don't want your Postscript printer talking to you */
  #undef	NOCHATTER
  
  /*	The only advantage to commenting-out one of these is to make the
--- 95,102 ----
   */
  #undef	NOCONTROLD
  
! /*	define if you don't want your Postscript printer talking to you.
! 	OR, if you're trying to drive xtroff patch level 9 or less. */
  #undef	NOCHATTER
  
  /*	The only advantage to commenting-out one of these is to make the
Index: ./INSTALL
*** /tmp/PATCHold/./INSTALL	Sat Jul 27 12:47:01 1991
--- ./INSTALL	Sat Jul 27 12:47:04 1991
***************
*** 1,5 ****
  		Psroff 3.0 Installation Instructions
! 			2.12 91/04/02
  
  Please see the TROUBLE file if you have difficulties.
  The README file does provide a bit more background on some
--- 1,5 ----
  		Psroff 3.0 Installation Instructions
! 			2.14 91/07/20
  
  Please see the TROUBLE file if you have difficulties.
  The README file does provide a bit more background on some
***************
*** 8,15 ****
  installation.  After building and installing psroff, you
  will want to read the MISC file for further tuning.
  
  I suggest you print this file and read it while you work through
! your configuration.
  
  	- Files that you will have to edit for proper configuration
  	  of psroff:
--- 8,23 ----
  installation.  After building and installing psroff, you
  will want to read the MISC file for further tuning.
  
+ This documentation is rather daunting I know.  However, there
+ are literally thousands of different ways to configure psroff,
+ depending on your version of UNIX, type of printer, display
+ configuration, font sources and so-on.  It's harder to install
+ psroff than most other similar packages, but psroff does more than
+ all the rest of them combined.  I think you'll consider the effort
+ worth it.
+ 
  I suggest you print this file and read it while you work through
! your configuration.  Work slowly and step-by-step.
  
  	- Files that you will have to edit for proper configuration
  	  of psroff:
***************
*** 21,27 ****
  	  Important note: as shipped, both defs.h and Makefile are
  	  configured for RS/6000 and most (if not all) stock System V's
  	  with the exception of MANDIR and MANEXT in Makefile.
! 	  psrofflib.S MUST be changed for each system in the field.
  
  	- Other files that may need to be customized for your needs:
  
--- 29,36 ----
  	  Important note: as shipped, both defs.h and Makefile are
  	  configured for RS/6000 and most (if not all) stock System V's
  	  with the exception of MANDIR and MANEXT in Makefile.
! 	  psrofflib.S MUST be changed for each system in the field to
! 	  define your printer spooler.
  
  	- Other files that may need to be customized for your needs:
  
***************
*** 33,61 ****
  
  	- If you have problems with the makefiles, you'll have to
  	  find a System 5 make.  Many systems have them squirrelled
! 	  away in odd places.  Eg: Ultrix: /usr/bin/s5make
  
! 	  If you have to do this, this should probably make things
! 	  work:
! 		MAKE=<your System V make> export MAKE
! 		<your System V make> <make arguments>
! 	  Eg:
! 		MAKE=/usr/bin/s5make export MAKE
! 		$(MAKE)
  
  	- If you're building for ditroff input only, ignore the discussions
  	  on HEADERSIZE and trofftype.
  
- 	- Ditroff input only: copy the appropriate
- 	  font width tables (try widthps/[A-Z]* for testing) to
- 	  /usr/lib/font/dev<type> and run makedev or mkfont on them.
- 
  	- NOTE: You may wish to try running "make check" at this
  	  point, it should be able to find out the correct "HEADERSIZE"
  	  and "trofftype" setting so you don't have to guess later on.
  	  In any event, if you have problems and wish to ask me for help,
  	  I will be requiring that you mail me a copy of the first
! 	  50 lines or so of "make check" output.
  
  	  If you're running on RISC Ultrix ignore any HEADERSIZE or
  	  trofftype messages.  The reason for this is that RISC
--- 42,66 ----
  
  	- If you have problems with the makefiles, you'll have to
  	  find a System 5 make.  Many systems have them squirrelled
! 	  away in odd places.
  
! 	  On Ultrix, for a successful build, you MUST modify the Makefile
! 	  and set SHELL to /usr/bin/sh5 (or ksh), and MAKE to /usr/bin/s5make.
! 	  Further, where the psroff instructions refer to "make", you must
! 	  always type "s5make" instead.  If you don't do this, the Makefiles
! 	  will abort with "Error n" without any other diagnostic information.
! 	  (Tested on RISC/Ultrix 4.2)
  
  	- If you're building for ditroff input only, ignore the discussions
  	  on HEADERSIZE and trofftype.
  
  	- NOTE: You may wish to try running "make check" at this
  	  point, it should be able to find out the correct "HEADERSIZE"
  	  and "trofftype" setting so you don't have to guess later on.
  	  In any event, if you have problems and wish to ask me for help,
  	  I will be requiring that you mail me a copy of the first
! 	  50 lines or so of "make check" output.  (But wait for me to
! 	  ask for it)
  
  	  If you're running on RISC Ultrix ignore any HEADERSIZE or
  	  trofftype messages.  The reason for this is that RISC
***************
*** 71,76 ****
--- 76,86 ----
  	  says something nasty about non-numeric character in file,
  	  "may be non-ASCII".
  
+ 	  [By the way, according to the Ultrix 4.1 release notes,
+ 	  troff is unsupported.  I've just put in a bug report,
+ 	  plus an offer of correctly formatted width tables, so we'll
+ 	  see if we can get DEC to put it in as a update]
+ 
  	  Apollos need the -F trofftype variant.  Their HEADERSIZE
  	  calculation is strange.  You should set HEADERSIZE
  	  to 0, and proceed with these instructions, but do NOT
***************
*** 109,115 ****
  
  	- If you are using the supplied width tables (widths/widthps),
  	  all is fine.  But, if you're going to be driving another
! 	  package (eg: jetroff, tpscript, psdit, xtroff etc.) I suggest
  	  you find the ditroff-format ASCII width tables (DESC, R, I,
  	  S etc.), copy them to the appropriate widths/width<xx> area,
  	  modify psrofflib.S to know how to use these width tables,
--- 119,125 ----
  
  	- If you are using the supplied width tables (widths/widthps),
  	  all is fine.  But, if you're going to be driving another
! 	  package (eg: jetroff, tpscript, psdit etc.) I suggest
  	  you find the ditroff-format ASCII width tables (DESC, R, I,
  	  S etc.), copy them to the appropriate widths/width<xx> area,
  	  modify psrofflib.S to know how to use these width tables,
***************
*** 116,126 ****
  	  and possibly create *.fonts and *.lib files.  psrofflib.S
  	  has copious comments on how to configure psroff.
  
  	  psdit, tpscript, xtroff, Pageview, Display Postscript and
  	  xproof work reasonably well using the Postscript widths in
  	  widthps.
  
! 	- edit Makefile and change whatever you need to.
  
  	- edit defs.h and define either BSD or ATT.  A few other options will
  	  pertain to you.  Take special note of HEADERSIZE.  Take a look
--- 126,141 ----
  	  and possibly create *.fonts and *.lib files.  psrofflib.S
  	  has copious comments on how to configure psroff.
  
+ 	  xtroff is supposedly already set - it should work
+ 	  "out-of-the-box".  Patch level 10 for xtroff is preferred.
+ 	  [Contact moraes@cs.toronto.edu for more details]
+ 
  	  psdit, tpscript, xtroff, Pageview, Display Postscript and
  	  xproof work reasonably well using the Postscript widths in
  	  widthps.
  
! 	- edit Makefile and change whatever you need to.  Everything
! 	  is copiously documented there.
  
  	- edit defs.h and define either BSD or ATT.  A few other options will
  	  pertain to you.  Take special note of HEADERSIZE.  Take a look
***************
*** 175,185 ****
  	  Take special note of -T/-F handling for troff (trofftype) -
  	  check out your troff manual page!  Suns and Ultrix want
  	  trofftype='-F/usr/lib/font/$width/ftXX'.  If you're running
! 	  postscript, you may want to eventually add the -Z option
  	  to the entry to make your printer REALLY run fast.
  
  	- If you're going to be driving HP Laserjets without a Postscript
! 	  cartridge:
  
  	  If you have PK fonts from TeX, ensure that PKFONTS
  	  is set reasonably in the Makefile.  type:
--- 190,207 ----
  	  Take special note of -T/-F handling for troff (trofftype) -
  	  check out your troff manual page!  Suns and Ultrix want
  	  trofftype='-F/usr/lib/font/$width/ftXX'.  If you're running
! 	  postscript or lj3, you may want to eventually add the -Z option
  	  to the entry to make your printer REALLY run fast.
  
+ 	  Also, take special note of the "lparg" setting for the
+ 	  entry you want to use - you *will* have to change lparg -
+ 	  usually to an invocation of "lp" (System Vish) or "lpr"
+ 	  (BSD/Sun/Ultrix etc.).  Consult your print spooler manual
+ 	  pages to make sure *all* of the arguments are okay.
+ 
  	- If you're going to be driving HP Laserjets without a Postscript
! 	  cartridge: [you can skip this step until you've tested
! 	  psroff, and then come back to it]
  
  	  If you have PK fonts from TeX, ensure that PKFONTS
  	  is set reasonably in the Makefile.  type:
***************
*** 244,252 ****
  	  please run "make test", fill in the blanks, and mail me the
  	  result.  (See the README for the address).  The test page
  	  exercises all R & S troff characters at 10 point, and displays
! 	  a few other characters at different point sizes.  If you don't
! 	  want to run psroff itself (eg: you've got troff2ps in a printer
! 	  daemon), type:
  
  		make TEST
  		tbl TEST | troff -t -T<whatever> | <troff2ps server>
--- 266,279 ----
  	  please run "make test", fill in the blanks, and mail me the
  	  result.  (See the README for the address).  The test page
  	  exercises all R & S troff characters at 10 point, and displays
! 	  a few other characters at different point sizes.
! 	  
! 	  If "make test" doesn't generate anything, consult the TROUBLE
! 	  file.  If it says "can't find rlp" or some such, you didn't
! 	  change the psrofflib file's lparg value for your configuration.
! 
! 	  If you don't want to run psroff itself (eg: you've got troff2ps
! 	  in a printer daemon), type:
  
  		make TEST
  		tbl TEST | troff -t -T<whatever> | <troff2ps server>
***************
*** 261,267 ****
  	  If you're running on Laserjets, and you're just using my
  	  fonts, you'll notice that the lines supposed to be 16 point
  	  won't be, and the "6" will be missing in italic and bold.
! 	  Get some decent fonts.
  
  	  For ditroff input, "make dittest" and "make DITTEST" correspond
  	  to "make test" and "make TEST".
--- 288,294 ----
  	  If you're running on Laserjets, and you're just using my
  	  fonts, you'll notice that the lines supposed to be 16 point
  	  won't be, and the "6" will be missing in italic and bold.
! 	  Get some decent fonts (see LASERFONTS file).
  
  	  For ditroff input, "make dittest" and "make DITTEST" correspond
  	  to "make test" and "make TEST".
Index: ./TROUBLE
*** /tmp/PATCHold/./TROUBLE	Sat Jul 27 12:47:20 1991
--- ./TROUBLE	Sat Jul 27 12:47:23 1991
***************
*** 1,4 ****
! 		Psroff 3.0 Trouble Shooting.... 2.13 91/05/10
  
  (psroff 1.0 users can use this to a certain extent.  This is relatively
  unchanged from Psroff 2.0 except for the ditroff input capability)
--- 1,4 ----
! 		Psroff 3.0 Trouble Shooting.... 2.15 91/07/20
  
  (psroff 1.0 users can use this to a certain extent.  This is relatively
  unchanged from Psroff 2.0 except for the ditroff input capability)
***************
*** 12,18 ****
  	make installwidths
  
  This is assuming that you got clean compiles (you should be able
! to fix your own compile problems).
  
  Unless specified, the remarks in this file pertain to CAT troff input,
  not ditroff input.
--- 12,21 ----
  	make installwidths
  
  This is assuming that you got clean compiles (you should be able
! to fix your own compile problems).  However, Ultrix is sufficiently
! odd to warrant mention here: if your makes blow up without much
! in the way of diagnostics, refer to the INSTALL file regarding
! the setting of SHELL, MAKE and use of "s5make" instead of "make".
  
  Unless specified, the remarks in this file pertain to CAT troff input,
  not ditroff input.
***************
*** 34,59 ****
  	- "width tables".  psroff's install generates CAT compatible width
  	  tables and installs them into $FONTDIR/<widthname>/ft*, where
  	  "widthname" is a token denoting the "set" of widths.  Postscript
! 	  printers (or ditroff driving postscript) use ps.  These are
! 	  the only widths I distribute directly.  The Makefile will
  	  install widths into widthname "lj" if you have laserjet fonts
  	  installed in the right place.
  
  	  With ditroff input, these width tables are only useful for
! 	  the optimizer.
  
  	- "width option", most troff's support a way of telling it where
  	  to look for the width tables.  Some support -T<widthname> (Xenix
! 	  f'r instance).  Others (Sun, Ultrix, most BSD's) specifically,
! 	  need "-F<directory>/<widthname>/ftXX".  Check your
! 	  man pages for troff.  This is should be specified by "trofftype"
! 	  in lib/psroff.lib.S.  If you have a "-T" version of troff,
! 	  FONTDIR *must* be /usr/lib/font.  If your troff supports neither
! 	  -T or -F (some real old versions of Xenix, V7 perchance), you
! 	  will have to install the width tables in FONTDIR directly and
! 	  specify trofftype as "".  Which will also mean that you can
! 	  only support one set of width tables.  (Unless you make binary
! 	  patches to your troff)
  
  	  In ditroff input, the trofftype is forced to be -T$width.
  
--- 37,65 ----
  	- "width tables".  psroff's install generates CAT compatible width
  	  tables and installs them into $FONTDIR/<widthname>/ft*, where
  	  "widthname" is a token denoting the "set" of widths.  Postscript
! 	  printers (or ditroff driving postscript) use ps.  These and lj3
! 	  are the only widths I distribute directly.  The Makefile will
  	  install widths into widthname "lj" if you have laserjet fonts
  	  installed in the right place.
  
  	  With ditroff input, these width tables are only useful for
! 	  the optimizer.  Psroff's makefiles contain hooks for running
! 	  the appropriate width table compiler and installing them.
  
  	- "width option", most troff's support a way of telling it where
  	  to look for the width tables.  Some support -T<widthname> (Xenix
! 	  f'r instance).  Others (Sun, Ultrix, most BSD's) need
! 	  "-F<directory>/<widthname>/ftXX".  Check your man pages for troff.
! 	  Note, however, that some manual page sets do not mention either
! 	  of these options - in that case it's probably -F.
! 	  
! 	  This is should be specified by "trofftype" in lib/psroff.lib.S.
! 	  If you have a "-T" version of troff, FONTDIR *must* be /usr/lib/font.
! 	  If your troff supports neither -T or -F (some real old versions of
! 	  Xenix, V7 perchance), you will have to install the width tables in
! 	  FONTDIR directly and specify trofftype as "".  Which will also mean
! 	  that you can only support one set of width tables.  (Unless you make
! 	  binary patches to your troff)
  
  	  In ditroff input, the trofftype is forced to be -T$width.
  
***************
*** 142,153 ****
  
      This *assumes* System V compatible MAKE.  If the makefile blows
      (syntax errors in particular), search your system for a System V
!     compatible version of make.  Ultrix: /usr/bin/s5make.  Gnumake should
!     work fine.  Most Suns need a change here too.  You will probably
!     have to:
! 	MAKE=<system 5 make> export MAKE
! 	<system 5 make>
!     to build everything.
  
  Psroff seems to work, but nothing prints:
  
--- 148,159 ----
  
      This *assumes* System V compatible MAKE.  If the makefile blows
      (syntax errors in particular), search your system for a System V
!     compatible version of make.  Ultrix: /usr/bin/s5make.  Gnumake
!     works fine.  Most Suns need a change here too.  If you do
!     find one, follow the instructions for Ultrix with the name
!     of the shell and makefile you find.  If you don't find one,
!     consult the "includeless make" section in MISC - the workarounds
!     may be sufficient.
  
  Psroff seems to work, but nothing prints:
  
***************
*** 206,211 ****
--- 212,221 ----
      Chances are your HP Laserjet clone doesn't support incremental
      downloading.  Try undefining INCR and rebuilding.
  
+ NEW INSTALL: make test generates pages of scramble on Postscript.
+ 
+     Probably HEADERSIZE is wrong, or ASCIIWIDTHS needs to be set.
+ 
  NEW INSTALL: the "6" is missing in the test page on the "16 point italic"
  and "16 point bold":
  
***************
*** 215,227 ****
      that it had previously incrementally downloaded.
  
      Get more fonts and make sure that lj.fonts is up-to-date with
!     the font set you have.
  
  Both NEW and OLD INSTALLS: truncated or possibly completely missing
      printjobs in Postscript.  Probably the printer has seen a syntax
      error or some such.  If you start up a "cat" from the device
      the printer is connected to, you can see the printer's error
!     messages.
  
  WORKING INSTALL (eg: it's worked fine before): same symptoms as previous.
  
--- 225,239 ----
      that it had previously incrementally downloaded.
  
      Get more fonts and make sure that lj.fonts is up-to-date with
!     the font set you have.   LJIII and LASERFONTS discusses font
!     sources.
  
  Both NEW and OLD INSTALLS: truncated or possibly completely missing
      printjobs in Postscript.  Probably the printer has seen a syntax
      error or some such.  If you start up a "cat" from the device
      the printer is connected to, you can see the printer's error
!     messages.  The cause for this is usually seen if you run
!     psroff debug.
  
  WORKING INSTALL (eg: it's worked fine before): same symptoms as previous.
  
***************
*** 376,382 ****
      Some ditroff's have different meanings for the same character
      spec.  ("@" in some ditroff drivers is a different character)
  
! My ditroff driver dies with errors about lines starting with "#":
  
      define NOCHATTER.
  
--- 388,395 ----
      Some ditroff's have different meanings for the same character
      spec.  ("@" in some ditroff drivers is a different character)
  
! My ditroff driver dies with errors about lines starting with "#"
! (ie: xtroff, patch level < 10):
  
      define NOCHATTER.
  
***************
*** 387,393 ****
  I get postscript printer errors on last page, or last page missing:
  
      Have you got a DEC LN03 or some other printer that doesn't
!     like trailing control-D's?  Define "NOCONTROLD" in defs.h
  
  Ditroff driver doesn't work/gives errors:
  
--- 400,407 ----
  I get postscript printer errors on last page, or last page missing:
  
      Have you got a DEC LN03 or some other printer that doesn't
!     like trailing control-D's?  Try adding -S to t2arg in psrofflib.
!     (this is typical of LAN-connected printers)
  
  Ditroff driver doesn't work/gives errors:
  
***************
*** 433,439 ****
        gotten any additional fonts, "make test" will show an example
        of this problem, in that the line supposedly 16 point will
        be the wrong size and some characters will be missing (italic
!       and bold "6")
  
  Laserjet: lousey/wrong/missing characters (non-S font):
  
--- 447,453 ----
        gotten any additional fonts, "make test" will show an example
        of this problem, in that the line supposedly 16 point will
        be the wrong size and some characters will be missing (italic
!       and bold "6").  See LASERFONTS/LJIII file.
  
  Laserjet: lousey/wrong/missing characters (non-S font):
  
***************
*** 489,494 ****
--- 503,510 ----
      If you see problems after running the test sheet, here are a few
      suggestions:
  
+ 	- No output, complaint about "rlp not found" - you've not updated
+ 	  the lparg value in the psrofflib entry you're using.
  	- Laserjet output: *badly* splattered, most characters unrecognizeable
  	  and probably more than one or two pages: If you're not using a Hewlett
  	  Packard Laserjet, try undefining INCR and rebuilding.  Some clones won't
Index: ./LJIII
*** /tmp/PATCHold/./LJIII	Sat Jul 27 12:47:41 1991
--- ./LJIII	Sat Jul 27 12:47:42 1991
***************
*** 1,4 ****
! 		PSROFF RELEASE 3.0 LJIII 1.2 91/04/05
  
  			Feb 19, 1991
  			Chris Lewis
--- 1,4 ----
! 		PSROFF RELEASE 3.0 LJIII 1.3 91/07/20
  
  			Feb 19, 1991
  			Chris Lewis
***************
*** 24,33 ****
  that the printer contains scalable typefaces.  Thus, psroff can treat
  it almost like a Postscript printer, and not download at all.  The
  other being that these scalable typefaces and an IBM PC program
! to generate SFP's (HP Soft font format) at any given size is being
! sold as a quite inexpensive product.  It allows you to buy the
! HPLJ III fonts and build a complete set of softfonts for your older
! printer.
  
  Further, the "DeskTop" symbolset available on LJIII's is a better match
  to what CAT Troff needs, so this is used instead of Roman-8 for the LJIII.
--- 24,33 ----
  that the printer contains scalable typefaces.  Thus, psroff can treat
  it almost like a Postscript printer, and not download at all.  The
  other being that these scalable typefaces and an IBM PC program
! (Type Director) to generate SFP's (HP Soft font format) at any given
! size is being sold as a quite inexpensive product.  It allows you to
! buy the HPLJ III fonts and build a complete set of softfonts for your
! older printer.
  
  Further, the "DeskTop" symbolset available on LJIII's is a better match
  to what CAT Troff needs, so this is used instead of Roman-8 for the LJIII.
***************
*** 58,64 ****
  from HP.  N.K. Krishnan (of HP, krishnan@iag.hp.com, did a lot of the hard
  work) and I could probably never reproduce the same set of steps again.
  Perhaps the simplest thing to do would be to copy an existing set and manually
! tweak them using the test sheet as a guide.
  
  Zapf-Dingbats Cartridge/S2 font:
  
--- 58,66 ----
  from HP.  N.K. Krishnan (of HP, krishnan@iag.hp.com, did a lot of the hard
  work) and I could probably never reproduce the same set of steps again.
  Perhaps the simplest thing to do would be to copy an existing set and manually
! tweak them using the test sheet as a guide.  OR, use "Type Director" to
! create a copy of the font at a given size, and run that thru the SFP to
! width table conversion process.
  
  Zapf-Dingbats Cartridge/S2 font:
  
***************
*** 80,87 ****
  
  Using Scaled fonts on non-LJIII's:
  
! If you obtain the scalable typefaces and the PC program, you can
! use the program to generate SFP's for each typeface at the CAT
  troff sizes.  You will want to build these fonts as Roman-8
  symbolsets.  Then, copy these files from your PC to your UNIX system
  that's running psroff.  (Don't forget to copy the files in *binary*
--- 82,89 ----
  
  Using Scaled fonts on non-LJIII's:
  
! If you obtain the scalable typefaces and "Type Director" for your PC,
! you can use the program to generate SFP's for each typeface at the CAT
  troff sizes.  You will want to build these fonts as Roman-8
  symbolsets.  Then, copy these files from your PC to your UNIX system
  that's running psroff.  (Don't forget to copy the files in *binary*
***************
*** 89,91 ****
--- 91,99 ----
  and install these fonts and the new width tables etc.  Without some
  work you will not be able to use a MATH-8 font produced in this way
  without borrowing some of the overrides from lj3.fonts into lj.fonts.
+ 
+ According to an HP Catalog, the part number for "Type Director 2.0"
+ packaged with 4 Times, 4 Univers, "Brush", "Dom Casual", "Park Avenue"
+ and "Uncial" typefaces is C2052B #ABA (3.5" floppy) or C2054B #ABA
+ (5.25" floppy).  There are quite a number of other scalable fonts
+ available on floppy.  Including Zapf Dingbats.
Index: ./Makefile
*** /tmp/PATCHold/./Makefile	Sat Jul 27 12:47:54 1991
--- ./Makefile	Sat Jul 27 12:47:55 1991
***************
*** 4,24 ****
  #    See the LICENSE file for a full description of the restrictions
  #    under which this software is provided.
  #
- #	This makefile requires System V compatible "make".  *Not* V7
- #	vanilla BSD or Ultrix or Sun.  Most modern systems will have
- #	a copy of the SV one somewhere (eg: .../s5bin/make).
- #
  #    Function: Upper level makefile; configuration options.
  #
  #
! #ident  "@(#)Makefile: 2.16 Copyright 91/04/02 17:02:22 Chris Lewis"
  
! #	Use s5make on Ultrix!
  MAKE	= make
  
  #	Only uncomment the following braindamage if your MAKE doesn't
! #	understand "include".
! #MAKE	= sed -e '/include/r ../makeincl' -e '/include/d' Makefile | make -f - $(MAKEFLAGS)
  
  #	Set to where you want the user-interfaces to go.  /usr/lbin
  #	is also common.  /usr/bin if you don't have a specific place
--- 4,27 ----
  #    See the LICENSE file for a full description of the restrictions
  #    under which this software is provided.
  #
  #    Function: Upper level makefile; configuration options.
  #
  #
! #ident  "@(#)Makefile: 2.20 Copyright 91/07/24 23:12:28 Chris Lewis"
  
! #	If you're not sure whether you have a System V make, leave
! #	this alone, and run the make anyways.  If it dies horribly
! #	in the subdirectories with messages like "don't know how to make xxxx",
! #	consult the MISC file under "Broken Makes" and follow the instructions
! #	there.
! #
! #	Use s5make on Ultrix, and always invoke as "s5make".
  MAKE	= make
  
  #	Only uncomment the following braindamage if your MAKE doesn't
! #	understand "include".  These are very rare and indicate you don't
! #	have a System V make - see the "Broken Makes" section in MISC.
! #MAKE	= sed -e '/^include/r ../makeincl' -e '/include/d' Makefile | make -f -
  
  #	Set to where you want the user-interfaces to go.  /usr/lbin
  #	is also common.  /usr/bin if you don't have a specific place
***************
*** 25,31 ****
  #	for non-standard programs.
  BINDIR	= /usr/local/bin
  
! #	Testing type (default postscript (ps)):
  #	Use lj for laserjet.
  TTYPE	= ps
  
--- 28,34 ----
  #	for non-standard programs.
  BINDIR	= /usr/local/bin
  
! #	Testing type (default: C/A/T troff driving postscript (ps)):
  #	Use lj for laserjet.
  TTYPE	= ps
  
***************
*** 66,73 ****
  
  #	Bourne shell.  *All* Bourne shells with the exception of extremely
  #	braindamaged ones (such as Ultrix or vanilla BSD) will work fine.
! #	Ultrix/Dynix may need the ... s5bin/sh one.  Korn or bash
! #	*should* work just fine, but I've never tested 'em.
  #
  #	This is also here for make, but if you have SHELL defined in your
  #	*own* environment, you can't trust this to work anyways.
--- 69,77 ----
  
  #	Bourne shell.  *All* Bourne shells with the exception of extremely
  #	braindamaged ones (such as Ultrix or vanilla BSD) will work fine.
! #	Ultrix/Dynix may need the ... s5bin/sh one.  ksh and bash
! #	*should* work just fine, but I've never tested 'em.  /usr/bin/sh5
! #	should be used on Ultrix.
  #
  #	This is also here for make, but if you have SHELL defined in your
  #	*own* environment, you can't trust this to work anyways.
***************
*** 102,108 ****
  COMPILE	=
  
  #	Compile flags needed to compile things on your machine.
! #	Usually just -O.  May need gcc stuff.
  #
  CCFLAGS = -O
  
--- 106,113 ----
  COMPILE	=
  
  #	Compile flags needed to compile things on your machine.
! #	Usually just -O.  May need to tell gcc that this isn't
! #	Posix compliant code.
  #
  CCFLAGS = -O
  
***************
*** 111,117 ****
  
  #	Do not comment any of the following out.  If you aren't going
  #	to use TeX PK fonts with HP Laserjet output, just NEVER execute
! #	makebuildljfonts.
  #
  #	If you have Rick Richardson's sfp2pk, set it's full path here:
  #	Only of interest for LJ/buildfonts.  If you don't have sfp2pk,
--- 116,122 ----
  
  #	Do not comment any of the following out.  If you aren't going
  #	to use TeX PK fonts with HP Laserjet output, just NEVER execute
! #	make buildljfonts.
  #
  #	If you have Rick Richardson's sfp2pk, set it's full path here:
  #	Only of interest for LJ/buildfonts.  If you don't have sfp2pk,
***************
*** 188,194 ****
  CFLAGS	= $(DEFINES)
  
  all:	troff2ps subst.done makeincl psroff README TROUBLE LASERFONTS \
! 	MISC DITROFF INSTALL LICENSE LJIII submakes
  
  subst.done:	sedscript
  	rm -f psroff makeincl
--- 193,199 ----
  CFLAGS	= $(DEFINES)
  
  all:	troff2ps subst.done makeincl psroff README TROUBLE LASERFONTS \
! 	MISC DITROFF INSTALL LICENSE LJIII zap submakes
  
  subst.done:	sedscript
  	rm -f psroff makeincl
***************
*** 239,246 ****
  
  buildljfonts:	unpackljfonts
  	make troff2ps makeincl
! 	cd lib ; make lj.fonts lj.lib
! 	cd utils ; make buildfonts
  
  installljfonts:
  	test -d $(LIBDIR) || mkdir $(LIBDIR)
--- 244,251 ----
  
  buildljfonts:	unpackljfonts
  	make troff2ps makeincl
! 	cd lib ; $(MAKE) lj.fonts lj.lib
! 	cd utils ; $(MAKE) buildfonts
  
  installljfonts:
  	test -d $(LIBDIR) || mkdir $(LIBDIR)
***************
*** 264,271 ****
  
  register:
  	make troff2ps makeincl
! 	cd lib ; make lj.fonts lj.lib
! 	cd widths ; make ljwidths widths
  	@echo "Now su to root and type 'make installwidths'"
  
  installwidths:	makeincl
--- 269,276 ----
  
  register:
  	make troff2ps makeincl
! 	cd lib ; $(MAKE) lj.fonts lj.lib
! 	cd widths ; $(MAKE) ljwidths widths
  	@echo "Now su to root and type 'make installwidths'"
  
  installwidths:	makeincl
***************
*** 341,347 ****
  #	Yes, this is a little wierd, but in this way I can figure
  #	out what you are...
  TEST:	Makefile defs.h tests/testtab.m tests/exttab.m makeincl
! 	cd lib ; make
  	rm -f TEST1 TEST2
  	PATH=.:$(LIBDIR):$$PATH \
  		troff2ps -V | sed -e 's/^.*- \(.*\)/.ds 2v "\1/' > TEST1
--- 346,352 ----
  #	Yes, this is a little wierd, but in this way I can figure
  #	out what you are...
  TEST:	Makefile defs.h tests/testtab.m tests/exttab.m makeincl
! 	cd lib ; $(MAKE)
  	rm -f TEST1 TEST2
  	PATH=.:$(LIBDIR):$$PATH \
  		troff2ps -V | sed -e 's/^.*- \(.*\)/.ds 2v "\1/' > TEST1
Index: ./audit.S
*** /tmp/PATCHold/./audit.S	Sat Jul 27 12:48:08 1991
--- ./audit.S	Sat Jul 27 12:48:11 1991
***************
*** 6,12 ****
  #    under which this software is provided.
  #
  #
! #	Psroff checking script 2.9 91/03/26
  chkinst=false
  for i
  do
--- 6,12 ----
  #    under which this software is provided.
  #
  #
! #	Psroff checking script 2.10 91/07/20
  chkinst=false
  for i
  do
***************
*** 19,24 ****
--- 19,27 ----
  	    ;;
      esac
  done
+ version=`sed -n \
+     -e 's/^#define[ 	]*T2VERSION[ 	]*"\(.*\)"*/\1/p' defs.h`
+ echo "INFO: T2VERSION = $version"
  eval "`sed -n -e 's/[()]//g' \
  	      -e 's/^LIBDIR.*=[ 	]*/LIBDIR=/p' \
  	      -e 's/^LJF.*=[ 	]*/LJF=/p' \
Index: ./utils.c
*** /tmp/PATCHold/./utils.c	Sat Jul 27 12:48:22 1991
--- ./utils.c	Sat Jul 27 12:48:26 1991
***************
*** 12,18 ****
  
  #ifndef	lint
  static char SCCSid[] =
!     "@(#)utils.c: 2.15 Copyright 91/05/30 01:46:27 Chris Lewis";
  #endif
  
  #ifndef	HEADERSIZE
--- 12,18 ----
  
  #ifndef	lint
  static char SCCSid[] =
!     "@(#)utils.c: 2.16 Copyright 91/07/13 03:08:46 Chris Lewis";
  #endif
  
  #ifndef	HEADERSIZE
***************
*** 77,85 ****
  	    if (!(inc = fopen(token, "r"))) {
  		char nbuf[512];
  		if (token[0] != '/') {
! 		    sprintf(nbuf, "%s/%s", LIBDIR, token);
  		    DBP((D_SPEC, "Trying to include %s\n", nbuf));
! 		    inc = fopen(nbuf, "r");
  		}
  	    }
  	}
--- 77,89 ----
  	    if (!(inc = fopen(token, "r"))) {
  		char nbuf[512];
  		if (token[0] != '/') {
! 		    sprintf(nbuf, "%s/%s", "lib", token);
  		    DBP((D_SPEC, "Trying to include %s\n", nbuf));
! 		    if (!(inc = fopen(nbuf, "r"))) {
! 			sprintf(nbuf, "%s/%s", LIBDIR, token);
! 			DBP((D_SPEC, "Trying to include %s\n", nbuf));
! 			inc = fopen(nbuf, "r");
! 		    }
  		}
  	    }
  	}
Index: ./zap
*** /tmp/PATCHold/./zap	Sat Jul 27 12:48:35 1991
--- ./zap	Sat Jul 27 12:48:38 1991
***************
*** 0 ****
--- 1,38 ----
+ :
+ #1.3 91/07/23: Used to bypass broken makes - see MISC "Broken makes"
+ if [ $# = 0 ]
+ then
+     make sedscript makeincl
+     for i in adapters lib widths tests man
+     do
+ 	cd $i
+ 	for j in *.S
+ 	do
+ 	    case $j in
+ 		s.*)
+ 		    echo "Skipping $i/$j"
+ 		    continue
+ 		    ;;
+ 		'*.S')
+ 		    echo "No .S files in $i"
+ 		    continue
+ 		    ;;
+ 	    esac
+ 	    f=`basename $j .S`
+ 	    echo "Extracting $f with variable substitutions from $j"
+ 	    ../sedscript < $j > $f
+ 	    chmod 755 $f
+ 	done
+ 	echo "Finished $i - touching subst.done"
+ 	touch subst.done
+ 	cd ../
+     done
+ else
+     cd widths
+     rm gfnttab.log
+     for i in width*
+     do
+ 	echo doing $i
+ 	./gfnttab $i >> gfnttab.log
+     done
+ fi
Index: ./LASERFONTS
*** /tmp/PATCHold/./LASERFONTS	Sat Jul 27 12:48:49 1991
--- ./LASERFONTS	Sat Jul 27 12:48:50 1991
***************
*** 1,5 ****
  	How to build Fonts and Width Tables for your Laserjet
! 			2.3 91/04/02
  
  This readme presents a general discussion on how to build fonts
  for psroff.  The first part gives a complete description of what
--- 1,5 ----
  	How to build Fonts and Width Tables for your Laserjet
! 			2.4 91/07/20
  
  This readme presents a general discussion on how to build fonts
  for psroff.  The first part gives a complete description of what
***************
*** 18,24 ****
  supply which has (nominally) MATH8 encodings.
  
  If you can obtain HP fonts, either as soft fonts on floppy or the
! Laserjet III scalable fonts plus PC program to scale them to given
  size, you just generate the fonts you want at the CAT troff sizes
  and then copy them to FONTDIR/lib/lj, fix lj.fonts and do a
  "make register" and "make installwidths"
--- 18,24 ----
  supply which has (nominally) MATH8 encodings.
  
  If you can obtain HP fonts, either as soft fonts on floppy or the
! Laserjet III scalable fonts plus "Type Director" to scale them to given
  size, you just generate the fonts you want at the CAT troff sizes
  and then copy them to FONTDIR/lib/lj, fix lj.fonts and do a
  "make register" and "make installwidths"

-- 
Chris Lewis; clewis@ferret.ocunix.on.ca; Phone: Canada 613 832-0541
Psroff 3.0 is in comp.sources.unix NOW!  YAHOO!!!!!!!
Ferret mailing list: ferret-request@ferret.ocunix.on.ca

exit 0 # Just in case...
